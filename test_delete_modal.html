<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload Delete Modal Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.0/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body class="bg-light">
    <div class="container mt-5">
        <div class="card">
            <div class="card-header">
                <h5>Upload Delete Modal Test</h5>
            </div>
            <div class="card-body">
                <p>Test the new upload deletion modal:</p>
                <button type="button" class="btn btn-danger" onclick="deleteUpload(123, 'test_image.jpg')">
                    Test Delete Modal
                </button>
                
                <div id="alerts-container" class="mt-3"></div>
            </div>
        </div>
    </div>
    
    <!-- Upload Lösch-Modal -->
    <div class="modal fade" id="deleteUploadModal" tabindex="-1" role="dialog" aria-labelledby="deleteUploadModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content" style="border-radius: 15px; border: none; box-shadow: 0 10px 25px rgba(0,0,0,0.2);">
                <div class="modal-header border-0" style="background: linear-gradient(135deg, #dc3545, #c82333); border-radius: 15px 15px 0 0;">
                    <h5 class="modal-title text-white" id="deleteUploadModalLabel">
                        <i class="bi bi-trash me-2"></i>
                        Upload löschen
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Schließen"></button>
                </div>
                <div class="modal-body px-4 py-4">
                    <div class="text-center mb-3">
                        <i class="bi bi-exclamation-triangle" style="font-size: 3rem; color: #dc3545;"></i>
                    </div>
                    <p class="text-center mb-3" style="font-size: 1.1rem; color: #6c757d;">
                        Möchtest du diese Datei wirklich löschen?
                    </p>
                    <p class="text-center mb-0" style="font-size: 0.9rem; color: #9b9b9b;">
                        <strong id="deleteUploadFileName">Dateiname</strong><br>
                        Diese Aktion kann nicht rückgängig gemacht werden.
                    </p>
                </div>
                <div class="modal-footer border-0 justify-content-center px-4 pb-4">
                    <button type="button" class="btn btn-outline-secondary me-2" data-bs-dismiss="modal" style="border-radius: 25px; padding: 8px 20px;">
                        <i class="bi bi-x-circle me-1"></i>
                        Abbrechen
                    </button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteUpload" style="border-radius: 25px; padding: 8px 20px; background: linear-gradient(135deg, #dc3545, #c82333); border: none;">
                        <i class="bi bi-trash me-1"></i>
                        Löschen
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Mock functions for testing
        function showAlert(title, message, type) {
            const alertsContainer = document.getElementById('alerts-container');
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
            alertDiv.innerHTML = `
                <strong>${title}</strong> ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            alertsContainer.appendChild(alertDiv);
        }
        
        async function performDeleteUpload(uploadId) {
            console.log(`Mock delete upload: ${uploadId}`);
            showAlert('Test erfolgreich', `Upload ${uploadId} would be deleted`, 'success');
        }
        
        // Include the actual deleteUpload function from guest_uploads.js
        async function deleteUpload(uploadId, fileName = null) {
            // Modal-Elemente abrufen
            const deleteModal = document.getElementById('deleteUploadModal');
            const fileNameElement = document.getElementById('deleteUploadFileName');
            const confirmButton = document.getElementById('confirmDeleteUpload');
            
            if (!deleteModal || !fileNameElement || !confirmButton) {
                // Fallback auf confirm Dialog wenn Modal nicht verfügbar
                if (!confirm('Möchtest du diese Datei wirklich löschen?')) {
                    return;
                }
                await performDeleteUpload(uploadId);
                return;
            }
            
            // Dateiname im Modal setzen
            fileNameElement.textContent = fileName || `Upload #${uploadId}`;
            
            // Event-Handler für Bestätigung
            const handleConfirmDelete = async () => {
                confirmButton.removeEventListener('click', handleConfirmDelete);
                
                // Modal schließen
                const bootstrapModal = bootstrap.Modal.getInstance(deleteModal);
                if (bootstrapModal) {
                    bootstrapModal.hide();
                }
                
                // Upload löschen
                await performDeleteUpload(uploadId);
            };
            
            // Event-Handler setzen
            confirmButton.addEventListener('click', handleConfirmDelete);
            
            // Modal anzeigen
            try {
                const bootstrapModal = new bootstrap.Modal(deleteModal);
                bootstrapModal.show();
            } catch (error) {
                console.error('Modal konnte nicht angezeigt werden:', error);
                // Fallback auf confirm Dialog
                if (confirm('Möchtest du diese Datei wirklich löschen?')) {
                    await performDeleteUpload(uploadId);
                }
            }
        }
    </script>
</body>
</html>
