{% extends "base.html" %}

{% block title %}Gästeliste - {{ brautpaar_namen or "Brautpaar heiratet" }}{% endblock %}

{% block extra_head %}
<style>
.table-dark th {
    background-color: #212529 !important;
    color: #fff !important;
    border-color: #32383e !important;
}
.table-dark td {
    border-color: #32383e !important;
}
.bg-pink {
    background-color: #e91e63 !important;
}
.bg-blue {
    background-color: #2196f3 !important;
}
.bg-purple {
    background-color: #9c27b0 !important;
}

/* Seiten-Badges mit Gradienten */
.badge-seite-braut {
    background: linear-gradient(135deg, #ff6b9d, #e91e63, #c2185b) !important;
    color: white !important;
    text-shadow: 0 1px 2px rgba(0,0,0,0.3);
    border: 1px solid rgba(255, 255, 255, 0.2);
    box-shadow: 0 2px 4px rgba(233, 30, 99, 0.3);
}

.badge-seite-braeutigam {
    background: linear-gradient(135deg, #64b5f6, #2196f3, #1976d2) !important;
    color: white !important;
    text-shadow: 0 1px 2px rgba(0,0,0,0.3);
    border: 1px solid rgba(255, 255, 255, 0.2);
    box-shadow: 0 2px 4px rgba(33, 150, 243, 0.3);
}

.badge-seite-beide {
    background: linear-gradient(135deg, #ffd54f, #d4af37, #b8860b) !important;
    color: white !important;
    text-shadow: 0 1px 2px rgba(0,0,0,0.4);
    border: 1px solid rgba(255, 255, 255, 0.2);
    box-shadow: 0 2px 4px rgba(212, 175, 55, 0.3);
}

/* Hover-Effekte für die Seiten-Badges */
.badge-seite-braut:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 8px rgba(233, 30, 99, 0.4);
    transition: all 0.2s ease;
}

.badge-seite-braeutigam:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 8px rgba(33, 150, 243, 0.4);
    transition: all 0.2s ease;
}

.badge-seite-beide:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 8px rgba(212, 175, 55, 0.4);
    transition: all 0.2s ease;
}
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h1><i class="bi bi-people"></i> Gästeliste</h1>
                <div class="d-flex gap-2">
                    <a href="/gaeste/import" class="btn btn-wedding-secondary">
                        <i class="bi bi-cloud-upload"></i> Import
                    </a>
                    <button type="button" class="btn btn-wedding-primary" data-bs-toggle="modal" data-bs-target="#addGuestModal">
                        <i class="bi bi-person-plus"></i> Gast hinzufügen
                    </button>
                </div>
            </div>
            
            <!-- Statistiken -->
            <div class="row mb-4">
                <div class="col-md-3">
                    <div class="card border-0 shadow-lg" style="background: linear-gradient(135deg, #d4af37, #f4e4bc); border-radius: 15px;">
                        <div class="card-body" style="color: #8b7355;">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h4 class="card-title" id="totalGuests" style="color: #8b7355;">0</h4>
                                    <p class="card-text" style="color: #8b7355;">Gesamt</p>
                                </div>
                                <div class="align-self-center">
                                    <i class="bi bi-people fs-1" style="color: #8b7355;"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card border-0 shadow-lg" style="background: linear-gradient(135deg, #e8d5a3, #f4e4bc); border-radius: 15px;">
                        <div class="card-body" style="color: #8b7355;">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h4 class="card-title" id="weisserSaalGuests" style="color: #8b7355;">0</h4>
                                    <p class="card-text" style="color: #8b7355;">Weißer Saal</p>
                                </div>
                                <div class="align-self-center">
                                    <i class="bi bi-heart fs-1" style="color: #8b7355;"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card border-0 shadow-lg" style="background: linear-gradient(135deg, #f4e4bc, #d4af37); border-radius: 15px;">
                        <div class="card-body" style="color: #8b7355;">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h4 class="card-title" id="essenGuests" style="color: #8b7355;">0</h4>
                                    <p class="card-text" style="color: #8b7355;">Essen</p>
                                </div>
                                <div class="align-self-center">
                                    <i class="bi bi-cup-straw fs-1" style="color: #8b7355;"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card border-0 shadow-lg" style="background: linear-gradient(135deg, #d4af37, #e8d5a3); border-radius: 15px;">
                        <div class="card-body" style="color: #8b7355;">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h4 class="card-title" id="partyGuests" style="color: #8b7355;">0</h4>
                                    <p class="card-text" style="color: #8b7355;">Party</p>
                                </div>
                                <div class="align-self-center">
                                    <i class="bi bi-music-note fs-1" style="color: #8b7355;"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Filter und Suche -->
            <div class="card mb-4 border-0 shadow-lg" style="border-radius: 15px; background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);">
                <div class="card-body">
                    <div class="row align-items-end">
                        <div class="col-md-3">
                            <label for="guestSearch" class="form-label">Suche</label>
                            <input type="text" class="form-control" id="guestSearch" 
                                   placeholder="Name oder Adresse suchen...">
                        </div>
                        <div class="col-md-2">
                            <label for="filterWeisserSaal" class="form-label">Weißer Saal</label>
                            <select class="form-select" id="filterWeisserSaal">
                                <option value="">Alle</option>
                                <option value="Ja">Ja</option>
                                <option value="Nein">Nein</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <label for="filterEssen" class="form-label">Essen</label>
                            <select class="form-select" id="filterEssen">
                                <option value="">Alle</option>
                                <option value="Ja">Ja</option>
                                <option value="Nein">Nein</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <label for="filterParty" class="form-label">Party</label>
                            <select class="form-select" id="filterParty">
                                <option value="">Alle</option>
                                <option value="Ja">Ja</option>
                                <option value="Nein">Nein</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <div class="d-flex gap-2">
                                <button type="button" class="btn btn-wedding-secondary" id="selectAllGuests">
                                    Alle auswählen
                                </button>
                                <button type="button" class="btn btn-wedding-warning" id="massEditBtn" disabled>
                                    <i class="bi bi-pencil-square"></i> Ausgewählte bearbeiten (0)
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Gästetabelle -->
            <div class="card border-0 shadow-lg" style="border-radius: 15px; background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);">
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead class="table-dark">
                                <tr>
                                    <th>
                                        <input type="checkbox" class="form-check-input" id="selectAllCheckbox">
                                    </th>
                                    <th>Vorname</th>
                                    <th>Nachname</th>
                                    <th>Kategorie</th>
                                    <th>Seite</th>
                                    <th>Gesamt</th>
                                    <th>Weißer Saal</th>
                                    <th>Essen</th>
                                    <th>Party</th>
                                    <th>Kinder</th>
                                    <th>Status</th>
                                    <th>Aktionen</th>
                                </tr>
                            </thead>
                            <tbody id="guestsTableBody">
                                <tr>
                                    <td colspan="12" class="text-center">
                                        <div class="spinner-border" role="status">
                                            <span class="visually-hidden">Lädt...</span>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal: Gast hinzufügen -->
<div class="modal fade" id="addGuestModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Neuen Gast hinzufügen</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="addGuestForm">
                    <!-- Grunddaten -->
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="guestVorname" class="form-label">Vorname *</label>
                            <input type="text" class="form-control" id="guestVorname" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="guestNachname" class="form-label">Nachname *</label>
                            <input type="text" class="form-control" id="guestNachname" required>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="guestKategorie" class="form-label">Kategorie *</label>
                            <select class="form-select" id="guestKategorie" required>
                                <option value="">Bitte wählen...</option>
                                <option value="Familie">Familie</option>
                                <option value="Freunde">Freunde</option>
                                <option value="Arbeit">Arbeit</option>
                                <option value="Sonstige">Sonstige</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="guestStatus" class="form-label">Status *</label>
                            <select class="form-select" id="guestStatus" required>
                                <option value="">Bitte wählen...</option>
                                <option value="Zugesagt">Zugesagt</option>
                                <option value="Abgesagt">Abgesagt</option>
                                <option value="Offen">Offen</option>
                            </select>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="guestSeite" class="form-label">Seite</label>
                            <select class="form-select" id="guestSeite">
                                <option value="">Bitte wählen...</option>
                                <option value="Käthe">Käthe</option>
                                <option value="Pascal">Pascal</option>
                                <option value="Beide">Beide</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="guestBegleitung" class="form-label">Begleitung</label>
                            <input type="text" class="form-control" id="guestBegleitung" placeholder="Name der Begleitung">
                        </div>
                    </div>

                    <!-- Kontaktdaten -->
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="guestEmail" class="form-label">E-Mail</label>
                            <input type="email" class="form-control" id="guestEmail">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="guestKontakt" class="form-label">Telefon</label>
                            <input type="text" class="form-control" id="guestKontakt">
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="guestAdresse" class="form-label">Adresse</label>
                        <textarea class="form-control" id="guestAdresse" rows="2"></textarea>
                    </div>

                    <!-- Anzahl Personen -->
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label for="guestAnzahlPersonen" class="form-label">Anzahl Personen gesamt</label>
                            <input type="number" class="form-control" id="guestAnzahlPersonen" min="0" value="1">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="guestKind" class="form-label">Anzahl Kinder</label>
                            <input type="number" class="form-control" id="guestKind" min="0" value="0">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="guestOptional" class="form-label">Optional</label>
                            <select class="form-select" id="guestOptional">
                                <option value="0">Nein</option>
                                <option value="1">Ja</option>
                            </select>
                        </div>
                    </div>

                    <!-- Teilnahme Anzahlen -->
                    <h6 class="mb-3 mt-4">Teilnahme (Anzahl Personen)</h6>
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label for="guestWeisserSaal" class="form-label">Weißer Saal</label>
                            <input type="number" class="form-control" id="guestWeisserSaal" min="0" value="0">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="guestAnzahlEssen" class="form-label">Essen <small class="text-muted">(inkl. Weißer Saal)</small></label>
                            <input type="number" class="form-control" id="guestAnzahlEssen" min="0" value="0">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="guestAnzahlParty" class="form-label">Party <small class="text-muted">(inkl. Essen)</small></label>
                            <input type="number" class="form-control" id="guestAnzahlParty" min="0" value="0">
                        </div>
                    </div>



                    <div class="mb-3">
                        <label for="guestBemerkungen" class="form-label">Bemerkungen</label>
                        <textarea class="form-control" id="guestBemerkungen" rows="2"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-wedding-secondary" data-bs-dismiss="modal">Abbrechen</button>
                <button type="button" class="btn btn-wedding-primary" id="saveGuestBtn">
                    <i class="bi bi-check-lg"></i> Speichern
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal: Gast bearbeiten -->
<div class="modal fade" id="editGuestModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Gast bearbeiten</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="editGuestForm">
                    <input type="hidden" id="editGuestIndex">
                    
                    <!-- Grunddaten -->
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="editGuestVorname" class="form-label">Vorname *</label>
                            <input type="text" class="form-control" id="editGuestVorname" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="editGuestNachname" class="form-label">Nachname *</label>
                            <input type="text" class="form-control" id="editGuestNachname" required>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label for="editGuestKategorie" class="form-label">Kategorie</label>
                            <select class="form-select" id="editGuestKategorie">
                                <option value="Familie">Familie</option>
                                <option value="Freunde">Freunde</option>
                            </select>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="editGuestSeite" class="form-label">Seite</label>
                            <select class="form-select" id="editGuestSeite">
                                <option value="Käthe">Käthe</option>
                                <option value="Pascal">Pascal</option>
                                <option value="Beide">Beide</option>
                            </select>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="editGuestStatus" class="form-label">Status</label>
                            <select class="form-select" id="editGuestStatus">
                                <option value="Offen">Offen</option>
                                <option value="Zugesagt">Zugesagt</option>
                                <option value="Abgesagt">Abgesagt</option>
                            </select>
                        </div>
                    </div>

                    <!-- Anzahl Personen -->
                    <div class="row">
                        <div class="col-md-3 mb-3">
                            <label for="editAnzahlPersonen" class="form-label">Gesamt Personen</label>
                            <input type="number" class="form-control" id="editAnzahlPersonen" min="0" value="1">
                        </div>
                        <div class="col-md-3 mb-3">
                            <label for="editAnzahlKinder" class="form-label">Kinder</label>
                            <input type="number" class="form-control" id="editAnzahlKinder" min="0" value="0">
                        </div>
                        <div class="col-md-3 mb-3">
                            <label for="editBegleitung" class="form-label">Begleitung</label>
                            <input type="number" class="form-control" id="editBegleitung" min="0" value="0">
                        </div>
                        <div class="col-md-3 mb-3">
                            <label for="editOptional" class="form-label">Optional</label>
                            <input type="number" class="form-control" id="editOptional" min="0" value="0">
                        </div>
                    </div>

                    <!-- Teilnahme Anzahlen -->
                    <h6 class="mb-3 mt-4">Teilnahme (Anzahl Personen)</h6>
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label for="editWeisserSaal" class="form-label">Weißer Saal</label>
                            <input type="number" class="form-control" id="editWeisserSaal" min="0" value="0">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="editAnzahlEssen" class="form-label">Essen <small class="text-muted">(inkl. Weißer Saal)</small></label>
                            <input type="number" class="form-control" id="editAnzahlEssen" min="0" value="0">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="editAnzahlParty" class="form-label">Party <small class="text-muted">(inkl. Essen)</small></label>
                            <input type="number" class="form-control" id="editAnzahlParty" min="0" value="0">
                        </div>
                    </div>

                    <!-- Zusätzliche Informationen -->
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="editGuestEmail" class="form-label">Email</label>
                            <input type="email" class="form-control" id="editGuestEmail">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="editGuestKontakt" class="form-label">Kontakt</label>
                            <input type="text" class="form-control" id="editGuestKontakt">
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="editGuestAdresse" class="form-label">Adresse</label>
                        <textarea class="form-control" id="editGuestAdresse" rows="2"></textarea>
                    </div>
                    
                    <div class="mb-3">
                        <label for="editGuestBemerkungen" class="form-label">Bemerkungen</label>
                        <textarea class="form-control" id="editGuestBemerkungen" rows="2"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-wedding-secondary" data-bs-dismiss="modal">Abbrechen</button>
                <button type="button" class="btn btn-wedding-primary" id="updateGuestBtn">
                    <i class="bi bi-check-lg"></i> Aktualisieren
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal: Masseneditierung -->
<div class="modal fade" id="massEditModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Ausgewählte Gäste bearbeiten</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="massEditForm">
                    <p class="text-muted">Wählen Sie die Eigenschaften aus, die Sie für alle ausgewählten Gäste ändern möchten:</p>
                    
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label for="massWeisserSaal" class="form-label">Weißer Saal</label>
                            <select class="form-select" id="massWeisserSaal">
                                <option value="">Nicht ändern</option>
                                <option value="Ja">Ja</option>
                                <option value="Nein">Nein</option>
                            </select>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="massEssen" class="form-label">Essen</label>
                            <select class="form-select" id="massEssen">
                                <option value="">Nicht ändern</option>
                                <option value="Ja">Ja</option>
                                <option value="Nein">Nein</option>
                            </select>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="massParty" class="form-label">Party</label>
                            <select class="form-select" id="massParty">
                                <option value="">Nicht ändern</option>
                                <option value="Ja">Ja</option>
                                <option value="Nein">Nein</option>
                            </select>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-wedding-secondary" data-bs-dismiss="modal">Abbrechen</button>
                <button type="button" class="btn btn-wedding-primary" id="saveMassEditBtn">
                    <i class="bi bi-check-lg"></i> Änderungen speichern
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/gaesteliste.js') }}?v=20250812001"></script>
{% endblock %}

