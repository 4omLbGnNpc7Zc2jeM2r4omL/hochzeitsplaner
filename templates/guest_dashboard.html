{% extends "base.html" %}

{% block title %}{{ brautpaar_namen or "Brautpaar heiratet" }} - Gäste-Dashboard{% endblock %}

{% block head %}
{{ super() }}
{% endblock %}

{# Überschreibe die Navigation für Gäste - ohne Burger-Menü #}
{% block navigation %}
<nav class="navbar navbar-expand-lg navbar-light border-bottom" style="background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);">
    <div class="container-fluid">
        <a class="navbar-brand" href="{{ url_for('guest_dashboard') }}" style="color: #8b7355; font-weight: 500;">
            <i class="bi bi-heart-fill me-2" style="color: #d4af37;"></i>
            {{ brautpaar_namen or "Hochzeitsplaner" }}
        </a>
        
        <!-- Direkte Navigation ohne Burger-Menü -->
        <div class="navbar-nav ms-auto">
            <span class="navbar-text me-3" style="color: #8b7355;">
                <i class="bi bi-person-heart me-1"></i>
                Willkommen, {{ session.display_name }}!
            </span>
            <a class="nav-link btn btn-outline-secondary btn-sm d-flex align-items-center" 
               href="{{ url_for('logout') }}" title="Abmelden"
               style="border-color: #d4af37; color: #8b7355;">
                <i class="bi bi-box-arrow-right me-1"></i>
                <span class="d-none d-md-inline">Abmelden</span>
            </a>
        </div>
    </div>
</nav>
{% endblock %}

{% block content %}
<!-- Mobile-optimierte Navigation -->
<div class="container-fluid p-0">
    <!-- Mobile Tab-Navigation -->
    <div class="row">
        <div class="col-12">
            <ul class="nav nav-pills nav-fill mb-3" id="guestDashboardTabs" role="tablist" style="background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%); padding: 0.5rem; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.08);">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="rsvp-tab" data-bs-toggle="pill" data-bs-target="#rsvp-pane" type="button" role="tab">
                        <i class="bi bi-calendar-check d-block d-md-inline me-md-1"></i>
                        <span class="d-none d-md-inline">RSVP</span>
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="zeitplan-tab" data-bs-toggle="pill" data-bs-target="#zeitplan-pane" type="button" role="tab">
                        <i class="bi bi-clock d-block d-md-inline me-md-1"></i>
                        <span class="d-none d-md-inline">Ablauf</span>
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="locations-tab" data-bs-toggle="pill" data-bs-target="#locations-pane" type="button" role="tab">
                        <i class="bi bi-geo-alt d-block d-md-inline me-md-1"></i>
                        <span class="d-none d-md-inline">Orte</span>
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="geschenke-tab" data-bs-toggle="pill" data-bs-target="#geschenke-pane" type="button" role="tab">
                        <i class="bi bi-gift d-block d-md-inline me-md-1"></i>
                        <span class="d-none d-md-inline">Geschenke</span>
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="uploads-tab" data-bs-toggle="pill" data-bs-target="#uploads-pane" type="button" role="tab">
                        <i class="bi bi-cloud-upload d-block d-md-inline me-md-1"></i>
                        <span class="d-none d-md-inline">Uploads</span>
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="gallery-tab" data-bs-toggle="pill" data-bs-target="#gallery-pane" type="button" role="tab">
                        <i class="bi bi-images d-block d-md-inline me-md-1"></i>
                        <span class="d-none d-md-inline">Galerie</span>
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="info-tab" data-bs-toggle="pill" data-bs-target="#info-pane" type="button" role="tab">
                        <i class="bi bi-info-circle d-block d-md-inline me-md-1"></i>
                        <span class="d-none d-md-inline">Info</span>
                    </button>
                </li>
            </ul>
        </div>
    </div>
    
    <!-- Tab Content -->
    <div class="tab-content" id="guestDashboardTabContent">
        <!-- RSVP Tab -->
        <div class="tab-pane fade show active" id="rsvp-pane" role="tabpanel">
            <div class="row justify-content-center">
                <div class="col-12 col-md-8 col-lg-6">
                    <!-- Willkommensnachricht nur im RSVP Tab -->
                    <div class="alert border-0 shadow-sm mb-4" id="welcomeMessage" 
                         style="background: linear-gradient(135deg, #e8d5a3, #f4e4bc); border-radius: 12px;">
                        <div class="d-flex align-items-center">
                            <div id="personalizedWelcome">
                                <h5 class="mb-1" style="color: #8b7355; font-weight: 500;">
                                    <i class="bi bi-person-heart me-2"></i>
                                    Willkommen, {{ session.display_name }}!
                                </h5>
                                <p class="mb-0 small" style="color: #8b7355;">
                                    Wir würden uns riesig freuen euch den ganzen Tag über bei uns zu haben - von der Trauung im Weißen Saal über das Hochzeitsessen bis hin zur Hochzeitsfeier! 💕🎉
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Deine Einladung Card über dem RSVP -->
                    <div class="card mb-3 border-0 shadow-lg" style="background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%); border-radius: 15px;">
                        <div class="card-header text-dark border-0" style="background: linear-gradient(135deg, #d4af37, #f4e4bc); border-radius: 15px 15px 0 0;">
                            <h5 class="mb-0" style="color: #8b7355; font-weight: 500;">
                                <i class="bi bi-envelope-heart me-2"></i>
                                Einladung
                            </h5>
                        </div>
                        <div class="card-body">
                            <p class="text-muted mb-3" style="color: #5a5a5a;">
                                Möchtest du deine persönliche Einladung nochmal ansehen?
                            </p>
                            
                            <div class="d-grid">
                                <button type="button" class="btn btn-lg rounded-pill shadow-sm" id="showInvitationBtn"
                                        style="background: linear-gradient(135deg, #d4af37, #f4e4bc); border: none; color: #8b7355; font-weight: 500; transition: all 0.3s ease;">
                                    <i class="bi bi-envelope-open-heart me-2"></i>
                                    Einladung anzeigen
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- RSVP Card -->
                    <div class="card border-0 shadow-lg" style="background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%); border-radius: 15px;">
                        <div class="card-header text-white border-0" style="background: linear-gradient(135deg, #d4af37, #f4e4bc); border-radius: 15px 15px 0 0;">
                            <h5 class="mb-0" style="color: #8b7355; font-weight: 500;">
                                <i class="bi bi-calendar-check me-2"></i>
                                <span id="teilnahmeTitle">Teilnahme</span>
                            </h5>
                        </div>
                        <div class="card-body">
                            <div id="rsvpForm">
                                <div class="mb-3">
                                    <label class="form-label fw-bold" style="color: #8b7355;">Status</label>
                                    <select class="form-select" id="guestStatus" style="border: 2px solid #d4af37; border-radius: 8px;">
                                        <option value="Offen" id="statusOpen">Noch nicht entschieden</option>
                                        <option value="Zugesagt" id="statusConfirmed">Ich komme gerne!</option>
                                        <option value="Abgesagt" id="statusDeclined">Kann leider nicht kommen</option>
                                    </select>
                                </div>
                                
                                <div class="mb-3" id="personenDiv">
                                    <label for="personenAnzahl" class="form-label fw-bold" style="color: #8b7355;">Anzahl Personen</label>
                                    <input type="number" class="form-control" id="personenAnzahl" min="1" max="1" value="1" 
                                           style="border: 2px solid #d4af37; border-radius: 8px;">
                                    <div class="form-text">
                                        Maximum: <span id="maxPersonen">1</span> Person(en)
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="guestNotiz" class="form-label fw-bold" style="color: #8b7355;">Nachricht (optional)</label>
                                    <textarea class="form-control" id="guestNotiz" rows="3" placeholder="Allergien, Wünsche, Grüße..."
                                              style="border: 2px solid #d4af37; border-radius: 8px;"></textarea>
                                </div>
                                
                                <div class="d-grid">
                                    <button type="button" class="btn btn-lg rounded-pill shadow-sm" id="saveRsvp"
                                            style="background: linear-gradient(135deg, #d4af37, #f4e4bc); border: none; color: #8b7355; font-weight: 500; transition: all 0.3s ease;">
                                        <i class="bi bi-check-circle me-2"></i>
                                        <span id="saveRsvpText">Teilnahme speichern</span>
                                    </button>
                                </div>
                            </div>
                            
                            <div id="rsvpSuccess" class="text-center d-none">
                                <i class="bi bi-check-circle-fill" style="font-size: 3rem; color: #d4af37;"></i>
                                <h5 class="mt-3" style="color: #8b7355;">Vielen Dank!</h5>
                                <p class="text-muted" id="rsvpSuccessText">Deine Teilnahme wurde gespeichert.</p>
                                
                                <!-- Einladung Button in RSVP Success -->
                                <div class="mt-3">
                                    <button type="button" class="btn btn-outline-warning rounded-pill" id="showInvitationBtnInRsvp"
                                            style="border: 2px solid #d4af37; color: #8b7355; font-weight: 500;">
                                        <i class="bi bi-envelope-open-heart me-2"></i>
                                        Einladung nochmal ansehen
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Zeitplan Tab -->
        <div class="tab-pane fade" id="zeitplan-pane" role="tabpanel">
            <div class="row justify-content-center">
                <div class="col-12">
                    <div class="card border-0 shadow-lg" style="background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%); border-radius: 15px;">
                        <div class="card-header text-white border-0" style="background: linear-gradient(135deg, #8b7355, #d4af37); border-radius: 15px 15px 0 0;">
                            <h5 class="mb-0" style="color: #ffffff; font-weight: 500;">
                                <i class="bi bi-clock me-2"></i>
                                Hochzeitsablauf
                            </h5>
                        </div>
                        <div class="card-body">
                            <div id="zeitplanComplete">
                                <!-- Vollständiger Zeitplan wird via JavaScript geladen -->
                                <div class="text-center">
                                    <div class="spinner-border spinner-border-sm" role="status" style="color: #d4af37;">
                                        <span class="visually-hidden">Lädt...</span>
                                    </div>
                                    <p class="mt-2 text-muted">Lade Zeitplan...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Locations Tab -->
        <div class="tab-pane fade" id="locations-pane" role="tabpanel">
            <div class="row justify-content-center">
                <div class="col-12">
                    <div class="card border-0 shadow-lg" style="background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%); border-radius: 15px;">
                        <div class="card-header text-white border-0" style="background: linear-gradient(135deg, #d4af37, #8b7355); border-radius: 15px 15px 0 0;">
                            <h5 class="mb-0" style="color: #ffffff; font-weight: 500;">
                                <i class="bi bi-geo-alt me-2"></i>
                                Locations & Anfahrt
                            </h5>
                        </div>
                        <div class="card-body">
                            <!-- Kompakte Kartenvorschauen -->
                            <div id="guestMapPreviewsSection">
                                <!-- Standesamt -->
                                <div id="guestStandesamtMapPreview" class="mb-3">
                                    <div class="card border-0 shadow-sm" style="border: 2px solid #d4af37 !important; border-radius: 12px;">
                                        <div class="card-header text-white py-2 border-0" style="background: linear-gradient(135deg, #d4af37, #f4e4bc); border-radius: 12px 12px 0 0;">
                                            <div class="d-flex justify-content-between align-items-center">
                                                <h6 class="mb-0" style="color: #8b7355; font-weight: 500;">
                                                    <i class="bi bi-building me-2"></i>
                                                    <span id="standesamtName">Standesamt</span>
                                                </h6>
                                                <div class="btn-group btn-group-sm">
                                                    <button type="button" class="btn btn-sm rounded-pill me-1 btn-maps btn-apple-maps" onclick="openInAppleMaps('standesamt')"
                                                            style="background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); color: #8b7355;"
                                                            title="In Apple Karten öffnen" data-bs-toggle="tooltip">
                                                        <img src="/static/icons/apple-maps-16.png" alt="Apple Karten" style="width: 16px; height: 16px;"><span class="d-none d-md-inline ms-1">Karten</span>
                                                    </button>
                                                    <button type="button" class="btn btn-sm rounded-pill btn-maps btn-google-maps" onclick="openInGoogleMaps('standesamt')"
                                                            style="background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); color: #8b7355;"
                                                            title="In Google Maps öffnen" data-bs-toggle="tooltip">
                                                        <img src="/static/icons/google-maps-16.png" alt="Google Maps" style="width: 16px; height: 16px;"><span class="d-none d-md-inline ms-1">Maps</span>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="card-body p-3">
                                            <div class="d-flex align-items-start mb-2">
                                                <i class="bi bi-geo-alt-fill me-2 mt-1" style="color: #d4af37;"></i>
                                                <span id="standesamtAdresse" class="text-muted small">Adresse wird geladen...</span>
                                            </div>
                                            
                                            <!-- Beschreibung -->
                                            <div id="standesamtBeschreibung" class="mb-3 small text-muted" style="line-height: 1.4;"></div>
                                            
                                            <!-- Kompakte Karte -->
                                            <div style="height: 300px; width: 100%; position: relative; overflow: hidden; border-radius: 8px; border: 2px solid #f8f9fa;">
                                                <div id="guestStandesamtMap" style="height: 100%; width: 100%;"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Hochzeitslocation -->
                                <div id="guestHochzeitslocationMapPreview" class="mb-3">
                                    <div class="card border-0 shadow-sm" style="border: 2px solid #8b7355 !important; border-radius: 12px;">
                                        <div class="card-header text-white py-2 border-0" style="background: linear-gradient(135deg, #8b7355, #d4af37); border-radius: 12px 12px 0 0;">
                                            <div class="d-flex justify-content-between align-items-center">
                                                <h6 class="mb-0" style="color: #ffffff; font-weight: 500;">
                                                    <i class="bi bi-heart-fill me-2"></i>
                                                    <span id="hochzeitslocationName">Hochzeitslocation</span>
                                                </h6>
                                                <div class="btn-group btn-group-sm">
                                                    <button type="button" class="btn btn-sm rounded-pill me-1 btn-maps btn-apple-maps" onclick="openInAppleMaps('hochzeitslocation')"
                                                            style="background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); color: #ffffff;"
                                                            title="In Apple Karten öffnen" data-bs-toggle="tooltip">
                                                        <img src="/static/icons/apple-maps-16.png" alt="Apple Karten" style="width: 16px; height: 16px;"><span class="d-none d-md-inline ms-1">Karten</span>
                                                    </button>
                                                    <button type="button" class="btn btn-sm rounded-pill btn-maps btn-google-maps" onclick="openInGoogleMaps('hochzeitslocation')"
                                                            style="background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); color: #ffffff;"
                                                            title="In Google Maps öffnen" data-bs-toggle="tooltip">
                                                        <img src="/static/icons/google-maps-16.png" alt="Google Maps" style="width: 16px; height: 16px;"><span class="d-none d-md-inline ms-1">Maps</span>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="card-body p-3">
                                            <div class="d-flex align-items-start mb-2">
                                                <i class="bi bi-geo-alt-fill me-2 mt-1" style="color: #8b7355;"></i>
                                                <span id="hochzeitslocationAdresse" class="text-muted small">Adresse wird geladen...</span>
                                            </div>
                                            
                                            <!-- Beschreibung -->
                                            <div id="hochzeitslocationBeschreibung" class="mb-3 small text-muted" style="line-height: 1.4;"></div>
                                            
                                            <!-- Kompakte Karte -->
                                            <div style="height: 300px; width: 100%; position: relative; overflow: hidden; border-radius: 8px; border: 2px solid #f8f9fa;">
                                                <div id="guestHochzeitslocationMap" style="height: 100%; width: 100%;"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Uploads Tab -->
        <div class="tab-pane fade" id="uploads-pane" role="tabpanel">
            <div class="row justify-content-center">
                <div class="col-12 col-md-10 col-lg-8">
                    <!-- Upload Form Card -->
                    <div class="card mb-4 border-0 shadow-lg" style="background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%); border-radius: 15px;">
                        <div class="card-header border-0" style="background: linear-gradient(135deg, #d4af37, #f4e4bc); border-radius: 15px 15px 0 0;">
                            <h5 class="mb-0" style="color: #8b7355; font-weight: 500;">
                                <i class="bi bi-cloud-upload me-2"></i>
                                Fotos & Videos hochladen
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="upload-area border-2 border-dashed rounded-3 p-4 text-center mb-4" 
                                 id="uploadArea" 
                                 style="border-color: #d4af37 !important; background: linear-gradient(135deg, #faf8f0 0%, #f8f6f0 100%); transition: all 0.3s ease;"
                                 onclick="document.getElementById('fileInput').click()">
                                <div class="upload-icon mb-3">
                                    <i class="bi bi-cloud-upload" style="font-size: 3rem; color: #d4af37;"></i>
                                </div>
                                <h6 style="color: #8b7355;">Dateien hier hinziehen oder klicken zum Auswählen</h6>
                                <p class="text-muted small mb-3">
                                    Erlaubte Formate: JPG, PNG, GIF, MP4, MOV, AVI<br>
                                    Maximale Größe: <span id="maxFileSize">50</span> MB pro Datei
                                </p>
                                <input type="file" id="fileInput" multiple accept="image/*,video/*" style="display: none;">
                                <button type="button" class="btn btn-outline-primary" onclick="event.stopPropagation(); document.getElementById('fileInput').click()" 
                                        style="border-color: #d4af37; color: #8b7355;">
                                    <i class="bi bi-folder2-open me-2"></i>
                                    Dateien auswählen
                                </button>
                            </div>
                            
                            <!-- Upload Progress -->
                            <div id="uploadProgress" style="display: none;">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <span class="small fw-bold" style="color: #8b7355;">Upload läuft...</span>
                                    <span class="small" id="uploadPercent">0%</span>
                                </div>
                                <div class="progress" style="height: 8px;">
                                    <div class="progress-bar" id="uploadProgressBar" 
                                         style="background: linear-gradient(135deg, #d4af37, #f4e4bc);" 
                                         role="progressbar" 
                                         aria-valuenow="0" 
                                         aria-valuemin="0" 
                                         aria-valuemax="100"></div>
                                </div>
                            </div>
                            
                            <!-- Selected Files List -->
                            <div id="selectedFiles" class="mt-3" style="display: none;">
                                <h6 style="color: #8b7355;">
                                    <i class="bi bi-files me-2"></i>
                                    Ausgewählte Dateien
                                </h6>
                                <div id="filesList" class="list-group mb-3"></div>
                                <div class="d-grid">
                                    <button type="button" class="btn btn-success btn-lg" id="uploadBtn" disabled 
                                            style="background: linear-gradient(135deg, #28a745, #20c997); border: none; color: white; font-weight: 500;">
                                        <i class="bi bi-cloud-upload me-2"></i>
                                        Jetzt hochladen
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- My Uploads Card -->
                    <div class="card border-0 shadow-lg" style="background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%); border-radius: 15px;">
                        <div class="card-header border-0" style="background: linear-gradient(135deg, #8b7355, #d4af37); border-radius: 15px 15px 0 0;">
                            <h5 class="mb-0" style="color: #ffffff; font-weight: 500;">
                                <i class="bi bi-collection me-2"></i>
                                Meine Uploads
                            </h5>
                        </div>
                        <div class="card-body">
                            <div id="myUploadsContainer">
                                <!-- Wird via JavaScript geladen -->
                                <div class="text-center">
                                    <div class="spinner-border spinner-border-sm" role="status" style="color: #d4af37;">
                                        <span class="visually-hidden">Lädt...</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Geschenke Tab -->
        <div class="tab-pane fade" id="geschenke-pane" role="tabpanel">
            <div class="row justify-content-center">
                <div class="col-12">
                    <!-- Geschenkliste Header -->
                    <div class="card mb-4 border-0 shadow-lg geschenkliste-info-card" style="background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);">
                        <div class="card-header border-0 geschenkliste-header">
                            <div class="d-flex justify-content-between align-items-center">
                                <h5 class="mb-0" style="color: #8b7355; font-weight: 500;" id="geschenkliste-titel">
                                    <i class="bi bi-gift me-2"></i>
                                    Unsere Geschenkliste
                                </h5>
                                <button class="geschenkliste-toggle" 
                                        data-bs-toggle="collapse" data-bs-target="#geschenkliste-info" 
                                        aria-expanded="true" aria-controls="geschenkliste-info"
                                        id="toggle-geschenkliste-info">
                                    <i class="bi bi-chevron-up" id="toggle-icon"></i>
                                </button>
                            </div>
                        </div>
                        <div class="card-body text-center collapse show" id="geschenkliste-info">
                            <p class="mb-3" style="color: #8b7355;" id="geschenkliste-beschreibung">
                                Wir haben eine kleine Geschenkliste für euch zusammengestellt. 
                                Ihr könnt euch ein Geschenk aussuchen, das euch gefällt - es wird dann für andere Gäste nicht mehr sichtbar sein.
                            </p>
                        </div>
                    </div>

                    <!-- Meine ausgewählten Geschenke -->
                    <div id="meine-geschenke-section" style="display: none;" class="mb-4">
                        <div class="card border-0 shadow-sm" style="background: linear-gradient(135deg, #e8f5e8 0%, #f0f8f0 100%); border-radius: 12px;">
                            <div class="card-header border-0" style="background: linear-gradient(135deg, #28a745, #20c997); border-radius: 12px 12px 0 0;">
                                <h6 class="mb-0" style="color: #ffffff; font-weight: 500;">
                                    <i class="bi bi-check-circle me-2"></i>
                                    Ihre ausgewählten Geschenke
                                </h6>
                            </div>
                            <div class="card-body" id="meine-geschenke-inhalt">
                                <!-- Wird via JavaScript gefüllt -->
                            </div>
                        </div>
                    </div>

                    <!-- Filter für verfügbare Geschenke -->
                    <div class="card mb-3 border-0 shadow-sm">
                        <div class="card-body">
                            <div class="row g-3">
                                <div class="col-md-4">
                                    <select class="form-select" id="dashboard-kategorie-filter" style="border-color: #d4af37;">
                                        <option value="">Alle Kategorien</option>
                                        <option value="Haushalt">Haushalt</option>
                                        <option value="Küche">Küche</option>
                                        <option value="Dekoration">Dekoration</option>
                                        <option value="Geld">Geldgeschenke</option>
                                        <option value="Sonstiges">Sonstiges</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <select class="form-select" id="dashboard-preis-filter" style="border-color: #d4af37;">
                                        <option value="">Alle Preisklassen</option>
                                        <option value="0-25">bis 25 €</option>
                                        <option value="25-50">25 - 50 €</option>
                                        <option value="50-100">50 - 100 €</option>
                                        <option value="100-200">100 - 200 €</option>
                                        <option value="200+">über 200 €</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <input type="text" class="form-control" id="dashboard-search-input" 
                                           placeholder="🔍 Geschenke suchen..." style="border-color: #d4af37;">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Verfügbare Geschenke Grid -->
                    <div id="dashboard-geschenke-loading" class="text-center py-4">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Lade...</span>
                        </div>
                        <p class="mt-2 text-muted">Geschenke werden geladen...</p>
                    </div>
                    
                    <!-- Geschenkliste Tabelle -->
                    <div id="dashboard-geschenke-container" style="display: none;">
                        <div class="card border-0 shadow-sm">
                            <div class="card-header" style="background: linear-gradient(135deg, var(--wedding-gold), var(--wedding-light-gold));">
                                <h6 class="mb-0" style="color: var(--wedding-text);">
                                    <i class="bi bi-gift me-2"></i>Verfügbare Geschenke
                                </h6>
                            </div>
                            <div class="card-body p-0">
                                <div class="table-responsive">
                                    <table class="table table-hover mb-0" id="dashboard-geschenke-table">
                                        <thead class="table-light">
                                            <tr>
                                                <th>Geschenk</th>
                                                <th>Kategorie</th>
                                                <th>Preis</th>
                                                <th>Verfügbar</th>
                                                <th>Aktionen</th>
                                            </tr>
                                        </thead>
                                        <tbody id="dashboard-geschenke-tbody">
                                            <!-- Wird via JavaScript gefüllt -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Keine Geschenke Nachricht -->
                    <div id="dashboard-keine-geschenke" style="display: none;" class="text-center py-5">
                        <div class="card border-0 shadow-sm">
                            <div class="card-body">
                                <i class="bi bi-gift" style="font-size: 3rem; color: #d4af37;"></i>
                                <h5 class="mt-3" style="color: #8b7355;">Alle Geschenke wurden bereits ausgewählt</h5>
                                <p class="text-muted">Vielen Dank für Ihr Interesse! Alle Geschenke aus unserer Liste wurden bereits von anderen Gästen ausgewählt.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Galerie Tab -->
        <div class="tab-pane fade" id="gallery-pane" role="tabpanel">
            <div class="row">
                <div class="col-12">
                    <div class="card border-0 shadow-lg" style="background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%); border-radius: 15px;">
                        <div class="card-header border-0" style="background: linear-gradient(135deg, #8b7355, #d4af37); border-radius: 15px 15px 0 0;">
                            <div class="d-flex justify-content-between align-items-center">
                                <h5 class="mb-0" style="color: #ffffff; font-weight: 500;">
                                    <i class="bi bi-images me-2"></i>
                                    Foto-Galerie
                                </h5>
                                <script>
                                // Funktion direkt hier definieren
                                function loadGallerySimple() {
                                    console.log('🔄 Simple Gallery Load called');
                                    fetch('/api/approved-gallery')
                                        .then(response => response.json())
                                        .then(data => {
                                            console.log('Gallery data:', data);
                                            window.galleryData = data; // Speichere für Modal-Galerie
                                            const container = document.getElementById('guestGalleryContainer');
                                            const loading = document.getElementById('guestGalleryLoading');
                                            if (loading) loading.style.display = 'none';
                                            if (container && data.length > 0) {
                                                let html = '';
                                                data.forEach((upload, index) => {
                                                    html += '<div class="col-lg-3 col-md-4 col-sm-6 col-12">';
                                                    html += '<div class="card">';
                                                    html += '<div class="card-body">';
                                                    html += '<img src="/api/gallery-thumbnail/' + upload.id + '" alt="' + upload.original_filename + '" style="width:100%; border-radius:8px; cursor:pointer;" onclick="openGalleryModal(' + index + ')">';
                                                    html += '<p class="mt-2"><strong>' + upload.original_filename + '</strong></p>';
                                                    html += '<p class="text-muted small">Von: Brautpaar</p>';
                                                    html += '</div>';
                                                    html += '</div>';
                                                    html += '</div>';
                                                });
                                                container.innerHTML = html;
                                            } else if (container) {
                                                container.innerHTML = '<div class="col-12"><div class="text-center py-5"><i class="bi bi-images" style="font-size: 4rem; color: #d4af37; opacity: 0.5;"></i><h5 class="mt-3" style="color: #8b7355;">Noch keine Fotos</h5><p class="text-muted">Es wurden noch keine Fotos für die Galerie freigegeben.</p></div></div>';
                                            }
                                        })
                                        .catch(error => console.error('Gallery error:', error));
                                }
                                
                                // Modal-Galerie Funktionen
                                let currentGalleryIndex = 0;
                                
                                function openGalleryModal(index) {
                                    currentGalleryIndex = index;
                                    showGalleryItem(index);
                                    const modal = new bootstrap.Modal(document.getElementById('galleryModal'));
                                    modal.show();
                                }
                                
                                function showGalleryItem(index) {
                                    if (!window.galleryData || !window.galleryData[index]) return;
                                    
                                    const item = window.galleryData[index];
                                    const modalBody = document.getElementById('galleryModalBody');
                                    const modalTitle = document.getElementById('galleryModalTitle');
                                    const prevBtn = document.getElementById('galleryPrevBtn');
                                    const nextBtn = document.getElementById('galleryNextBtn');
                                    const counter = document.getElementById('galleryCounter');
                                    
                                    // Update counter
                                    counter.textContent = `${index + 1} / ${window.galleryData.length}`;
                                    
                                    // Update title - nur "Foto" oder "Video" anzeigen
                                    const isVideo = item.original_filename.toLowerCase().match(/\.(mp4|webm|ogg|mov|avi)$/);
                                    modalTitle.textContent = isVideo ? 'Video' : 'Foto';
                                    
                                    // Update navigation buttons
                                    prevBtn.disabled = (index === 0);
                                    nextBtn.disabled = (index === window.galleryData.length - 1);
                                    
                                    if (isVideo) {
                                        modalBody.innerHTML = `
                                            <video controls style="width: 100%; max-height: 70vh;" preload="metadata">
                                                <source src="/api/gallery-image/${item.id}" type="video/mp4">
                                                Ihr Browser unterstützt das Video-Element nicht.
                                            </video>
                                        `;
                                    } else {
                                        modalBody.innerHTML = `
                                            <img src="/api/gallery-image/${item.id}" alt="Foto" 
                                                 style="width: 100%; max-height: 70vh; object-fit: contain;">
                                        `;
                                    }
                                }
                                
                                function navigateGallery(direction) {
                                    if (direction === 'prev' && currentGalleryIndex > 0) {
                                        currentGalleryIndex--;
                                    } else if (direction === 'next' && currentGalleryIndex < window.galleryData.length - 1) {
                                        currentGalleryIndex++;
                                    }
                                    showGalleryItem(currentGalleryIndex);
                                }
                                
                                // Keyboard navigation
                                document.addEventListener('keydown', function(e) {
                                    const modal = document.getElementById('galleryModal');
                                    if (modal && modal.classList.contains('show')) {
                                        if (e.key === 'ArrowLeft') {
                                            navigateGallery('prev');
                                        } else if (e.key === 'ArrowRight') {
                                            navigateGallery('next');
                                        } else if (e.key === 'Escape') {
                                            bootstrap.Modal.getInstance(modal).hide();
                                        }
                                    }
                                });
                                </script>
                                <button type="button" class="btn btn-outline-light btn-sm" onclick="loadGallerySimple()">
                                    <i class="bi bi-arrow-clockwise me-1"></i>
                                    <span class="d-none d-sm-inline">Aktualisieren</span>
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <script>
                            // Auto-Load beim Tab-Wechsel
                            document.addEventListener('DOMContentLoaded', function() {
                                // Event Listener für Tab-Wechsel
                                const galleryTab = document.getElementById('gallery-tab');
                                if (galleryTab) {
                                    galleryTab.addEventListener('shown.bs.tab', function (e) {
                                        console.log('📸 Galerie-Tab aktiviert - lade Fotos...');
                                        loadGallerySimple();
                                    });
                                }
                                
                                // Prüfe, ob Galerie-Tab beim Start aktiv ist
                                setTimeout(function() {
                                    const galleryPane = document.getElementById('gallery-pane');
                                    if (galleryPane && galleryPane.classList.contains('show', 'active')) {
                                        console.log('📸 Galerie-Tab ist bereits aktiv - lade Fotos...');
                                        loadGallerySimple();
                                    }
                                }, 500);
                            });
                            </script>
                            <!-- Filter und Suche für Gäste-Galerie -->
                            <div class="row mb-3">
                                <div class="col-md-8">
                                    <div class="input-group">
                                        <span class="input-group-text" style="background: #f8f9fa; border-color: #d4af37;">
                                            <i class="bi bi-search"></i>
                                        </span>
                                        <input type="text" class="form-control" id="guestGallerySearch" 
                                               placeholder="Fotos durchsuchen..." 
                                               onkeyup="filterGuestGallery()"
                                               style="border-color: #d4af37;">
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <select class="form-select" id="guestGalleryTypeFilter" 
                                            onchange="filterGuestGallery()"
                                            style="border-color: #d4af37;">
                                        <option value="">Alle Dateitypen</option>
                                        <option value="image">Nur Bilder</option>
                                        <option value="video">Nur Videos</option>
                                    </select>
                                </div>
                            </div>
                            
                            <!-- Loading Animation -->
                            <div class="text-center py-5 d-none" id="guestGalleryLoading">
                                <div class="spinner-border" style="color: #d4af37;" role="status">
                                    <span class="visually-hidden">Lädt...</span>
                                </div>
                                <p class="mt-2 text-muted">Galerie wird geladen...</p>
                            </div>
                            
                            <!-- Galerie Grid -->
                            <div class="row" id="guestGalleryContainer">
                                <!-- Wird dynamisch gefüllt -->
                            </div>
                            
                            <!-- Keine Fotos Nachricht -->
                            <div class="row d-none" id="guestGalleryNoPhotos">
                                <div class="col-12">
                                    <div class="text-center py-5">
                                        <i class="bi bi-images" style="font-size: 4rem; color: #d4af37; opacity: 0.5;"></i>
                                        <h5 class="mt-3" style="color: #8b7355;">Noch keine Fotos</h5>
                                        <p class="text-muted">Es wurden noch keine Fotos für die Galerie freigegeben.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Informationen Tab -->
        <div class="tab-pane fade" id="info-pane" role="tabpanel">
            <div class="row justify-content-center">
                <div class="col-12 col-md-8 col-lg-6">
                    <div class="card mb-3 border-0 shadow-lg" style="background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%); border-radius: 15px;">
                        <div class="card-header border-0" style="background: linear-gradient(135deg, #8b7355, #d4af37); border-radius: 15px 15px 0 0;">
                            <h5 class="mb-0" style="color: #ffffff; font-weight: 500;">
                                <i class="bi bi-info-circle me-2"></i>
                                Wichtige Informationen
                            </h5>
                        </div>
                        <div class="card-body">
                            <div id="guestInformationenContainer">
                                <!-- Wird via JavaScript geladen -->
                                <div class="text-center">
                                    <div class="spinner-border spinner-border-sm" role="status" style="color: #d4af37;">
                                        <span class="visually-hidden">Lädt...</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- First Login Welcome Modal - Einladungskarten Design -->
<div class="modal fade" id="firstLoginModal" tabindex="-1" aria-labelledby="firstLoginModalLabel" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content border-0 shadow-lg" style="background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);">
            <div class="modal-body p-0">
                <!-- Einladungskarte Design -->
                <div class="invitation-card text-center p-5" style="background: #ffffff; border-radius: 15px; box-shadow: 0 8px 32px rgba(0,0,0,0.1);">
                    
                    <!-- Hochzeitsdatum oben -->
                    <div class="wedding-date mb-4">
                        <h3 id="weddingDateDisplay" class="text-elegant mb-3" style="font-family: 'Playfair Display', serif; font-weight: 300; color: #8b7355; letter-spacing: 2px;">
                            25. Juli 2026
                        </h3>
                        <hr class="elegant-divider mx-auto" style="width: 150px; height: 2px; background: linear-gradient(90deg, transparent, #d4af37, transparent); border: none;">
                    </div>
                    
                    <!-- Foto Bereich -->
                    <div class="wedding-photo mb-4">
                        <div id="welcomeImageContainer" class="d-none">
                            <img id="welcomeImage" src="" alt="Hochzeitsfoto" class="img-fluid shadow-lg" 
                                 style="max-height: 300px; max-width: 100%; object-fit: cover; border-radius: 10px; border: 3px solid #f8f9fa;">
                        </div>
                        <div id="welcomeImagePlaceholder" class="photo-placeholder p-4" 
                             style="background: linear-gradient(45deg, #f8f9fa, #e9ecef); border-radius: 10px; border: 2px dashed #d4af37;">
                            <i class="bi bi-heart-fill text-muted opacity-50" style="font-size: 4rem;"></i>
                            <p class="text-muted mt-2 mb-0">Hochzeitsfoto</p>
                        </div>
                    </div>
                    
                    <!-- Trennstrich unter dem Foto -->
                    <hr class="elegant-divider mx-auto mb-4" style="width: 150px; height: 2px; background: linear-gradient(90deg, transparent, #d4af37, transparent); border: none;">
                    
                    <!-- Header Emojis -->
                    <div class="rings-emoji mb-4">
                        <span id="invitationRings" style="font-size: 2.5rem; display: none;"></span>
                    </div>
                    
                    <!-- Einladungstext -->
                    <div class="invitation-text">
                        <h4 id="invitationHeader" class="text-elegant mb-3" style="font-family: 'Playfair Display', serif; font-weight: 400; color: #8b7355; display: none;">
                        </h4>
                        <div id="welcomeText" class="text-content mx-auto" 
                             style="font-family: 'Crimson Text', serif; font-size: 1.1rem; line-height: 1.8; color: #5a5a5a; max-width: 400px;">
                            Liebe Familie,<br>
                            liebe Freunde,<br><br>
                            schön, dass ihr bis hier her gefunden habt und unsere Hochzeit am 25.07.2026 mit uns feiern möchtest.<br><br>
                            Auf dieser Website habt ihr die Möglichkeit....
                        </div>
                    </div>
                    
                    <!-- Weiter Button -->
                    <div class="mt-5">
                        <button type="button" class="btn btn-elegant btn-lg px-5 py-3 rounded-pill shadow-sm" 
                                data-bs-dismiss="modal"
                                style="background: linear-gradient(135deg, #d4af37, #f4e4bc); border: none; color: #8b7355; font-weight: 500; letter-spacing: 1px; transition: all 0.3s ease;">
                            ✨ Zur Hochzeitswebsite ✨
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Guest Gallery Fullscreen Modal -->
<div class="modal fade" id="guestFullscreenModal" tabindex="-1" aria-labelledby="guestFullscreenModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-fullscreen">
        <div class="modal-content bg-dark">
            <!-- Floating Close Button (top-right) -->
            <button type="button" class="guest-custom-close-btn position-absolute" data-bs-dismiss="modal" aria-label="Schließen" style="top: 20px; right: 20px; z-index: 1060;">
                <i class="bi bi-x-lg"></i>
            </button>
            
            <!-- Full viewport body -->
            <div class="modal-body p-0 d-flex align-items-center justify-content-center position-relative" style="height: 100vh;">
                <!-- Navigation Buttons -->
                <button type="button" class="btn btn-outline-light position-absolute guest-nav-btn" id="guestPrevBtn" 
                        onclick="window.showGuestPrevious()" 
                        style="left: 20px; top: 50%; transform: translateY(-50%); z-index: 1040; display: none;">
                    <i class="bi bi-chevron-left"></i>
                </button>
                <button type="button" class="btn btn-outline-light position-absolute guest-nav-btn" id="guestNextBtn" 
                        onclick="window.showGuestNext()" 
                        style="right: 20px; top: 50%; transform: translateY(-50%); z-index: 1040; display: none;">
                    <i class="bi bi-chevron-right"></i>
                </button>
                
                <!-- Media content -->
                <img id="guestFullscreenImage" src="" alt="" class="img-fluid guest-fullscreen-media" 
                     style="max-height: 75vh !important; max-width: 75vw !important; width: auto !important; height: auto !important; object-fit: contain !important; border-radius: 16px !important; box-shadow: 0 12px 48px rgba(0, 0, 0, 0.7) !important;">
                <video id="guestFullscreenVideo" controls class="img-fluid guest-fullscreen-media d-none" 
                       playsinline webkit-playsinline preload="metadata"
                       style="max-height: 75vh !important; max-width: 75vw !important; width: auto !important; height: auto !important; object-fit: contain !important; border-radius: 16px !important; box-shadow: 0 12px 48px rgba(0, 0, 0, 0.7) !important;">
                    <source src="" type="">
                    Ihr Browser unterstützt dieses Video-Format nicht.
                </video>
            </div>
            
            <!-- Floating Footer -->
            <div class="modal-footer border-0 position-absolute bottom-0 w-100" style="z-index: 1050; background: linear-gradient(0deg, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0.4) 50%, transparent 100%); backdrop-filter: blur(10px);">
                <div class="d-flex justify-content-between w-100 text-white align-items-center">
                    <div style="text-shadow: 0 2px 4px rgba(0,0,0,0.8);">
                        <span id="guestModalUploadInfo" class="fs-5 fw-semibold">Upload-Informationen</span>
                    </div>
                    <div>
                        <button type="button" class="btn btn-outline-light me-2 guest-modal-action-btn" onclick="downloadGuestFile()">
                            <i class="bi bi-download me-1"></i>Herunterladen
                        </button>
                        <button type="button" class="btn btn-outline-light guest-modal-action-btn" data-bs-dismiss="modal">
                            <i class="bi bi-x-lg me-1"></i>Schließen
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Geldgeschenk Auswahl Modal -->
<div class="modal fade" id="geldgeschenkModal" tabindex="-1" aria-labelledby="geldgeschenkModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title fw-bold" id="geldgeschenkModalLabel">
                    <i class="bi bi-heart-fill me-2"></i>Geldgeschenk auswählen
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Schließen"></button>
            </div>
            <div class="modal-body p-4">
                <div class="text-center mb-4">
                    <div class="display-1 mb-3" style="color: var(--wedding-gold);">💰</div>
                    <h4 id="geldgeschenkName" class="fw-bold" style="color: var(--wedding-text);"></h4>
                    <p id="geldgeschenkBeschreibung" class="text-muted"></p>
                </div>
                
                <form id="geldgeschenkForm">
                    <div class="mb-3">
                        <label for="geldgeschenkBetrag" class="form-label fw-semibold">
                            <i class="bi bi-currency-euro me-1"></i>Betrag (optional)
                        </label>
                        <input type="number" class="form-control form-control-lg" id="geldgeschenkBetrag" 
                               placeholder="Ihr Wunschbetrag in EUR" min="1" step="0.01">
                    </div>
                    
                    <div class="mb-4">
                        <label for="geldgeschenkNotiz" class="form-label fw-semibold">
                            <i class="bi bi-chat-heart me-1"></i>Persönliche Nachricht (optional)
                        </label>
                        <textarea class="form-control" id="geldgeschenkNotiz" rows="3" 
                                  placeholder="Ihre persönlichen Wünsche oder Nachricht an das Brautpaar..."></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer border-0 pt-0">
                <button type="button" class="btn btn-light btn-lg me-2" data-bs-dismiss="modal">
                    <i class="bi bi-x-circle me-1"></i>Abbrechen
                </button>
                <button type="button" class="btn btn-wedding-primary btn-lg" id="confirmGeldgeschenk">
                    <i class="bi bi-heart-fill me-1"></i>Geldgeschenk auswählen
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Geschenk Freigabe Bestätigungs Modal -->
<div class="modal fade" id="freigebenModal" tabindex="-1" aria-labelledby="freigebenModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title fw-bold" id="freigebenModalLabel">
                    <i class="bi bi-arrow-counterclockwise me-2"></i>Geschenk freigeben
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Schließen"></button>
            </div>
            <div class="modal-body p-4 text-center">
                <div class="display-1 mb-3" style="color: var(--wedding-gold);">⚠️</div>
                <h5 id="freigebenGeschenkName" class="fw-bold mb-3"></h5>
                <p class="text-muted mb-4">
                    Möchten Sie dieses Geschenk wirklich freigeben?<br>
                    <small>Das Geschenk wird dann wieder für andere Gäste verfügbar sein.</small>
                </p>
            </div>
            <div class="modal-footer border-0 pt-0">
                <button type="button" class="btn btn-light btn-lg me-2" data-bs-dismiss="modal">
                    <i class="bi bi-x-circle me-1"></i>Abbrechen
                </button>
                <button type="button" class="btn btn-wedding-secondary btn-lg" id="confirmFreigeben">
                    <i class="bi bi-arrow-counterclockwise me-1"></i>Jetzt freigeben
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Geldgeschenk Freigabe Bestätigungs Modal -->
<div class="modal fade" id="geldgeschenkFreigebenModal" tabindex="-1" aria-labelledby="geldgeschenkFreigebenModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title fw-bold" id="geldgeschenkFreigebenModalLabel">
                    <i class="bi bi-arrow-counterclockwise me-2"></i>Geldgeschenk freigeben
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Schließen"></button>
            </div>
            <div class="modal-body p-4 text-center">
                <div class="display-1 mb-3" style="color: var(--wedding-gold);">💰</div>
                <h5 class="fw-bold mb-3">Geldgeschenk freigeben?</h5>
                <p class="text-muted mb-4">
                    Möchten Sie Ihr Geldgeschenk wirklich freigeben?<br>
                    <small>Das Geldgeschenk wird dann wieder für Sie verfügbar sein.</small>
                </p>
            </div>
            <div class="modal-footer border-0 pt-0">
                <button type="button" class="btn btn-light btn-lg me-2" data-bs-dismiss="modal">
                    <i class="bi bi-x-circle me-1"></i>Abbrechen
                </button>
                <button type="button" class="btn btn-wedding-secondary btn-lg" id="confirmGeldgeschenkFreigeben">
                    <i class="bi bi-arrow-counterclockwise me-1"></i>Jetzt freigeben
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Geschenk Detail Modal -->
<div class="modal fade" id="geschenkDetailModal" tabindex="-1" aria-labelledby="geschenkDetailModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title fw-bold" id="geschenkDetailModalLabel">
                    <i class="bi bi-gift me-2"></i>Geschenk Details
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Schließen"></button>
            </div>
            <div class="modal-body p-4">
                <div class="row">
                    <div class="col-md-6" id="geschenkDetailBild">
                        <!-- Bild wird hier eingefügt wenn vorhanden -->
                    </div>
                    <div class="col-md-6" id="geschenkDetailInfo">
                        <h4 id="geschenkDetailName" class="fw-bold mb-3" style="color: var(--wedding-text);"></h4>
                        
                        <div class="mb-3">
                            <span class="badge me-2" id="geschenkDetailKategorie" style="background-color: var(--wedding-gold); color: var(--wedding-text);"></span>
                            <span class="badge" id="geschenkDetailPrioritaet"></span>
                        </div>
                        
                        <div class="mb-3">
                            <strong style="color: var(--wedding-gold);" id="geschenkDetailPreis"></strong>
                        </div>
                        
                        <div class="mb-3">
                            <small class="text-muted">Verfügbar: <span id="geschenkDetailVerfuegbar"></span></small>
                        </div>
                        
                        <div class="mb-4">
                            <h6 style="color: var(--wedding-text);">Beschreibung:</h6>
                            <p class="text-muted" id="geschenkDetailBeschreibung"></p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer border-0 pt-0">
                <button type="button" class="btn btn-light btn-lg me-2" data-bs-dismiss="modal">
                    <i class="bi bi-x-circle me-1"></i>Schließen
                </button>
                <button type="button" class="btn btn-outline-primary btn-lg me-2" id="geschenkDetailProduktLink" style="display: none;">
                    <i class="bi bi-box-arrow-up-right me-1"></i>Zur Produktseite
                </button>
                <button type="button" class="btn btn-wedding-primary btn-lg" id="geschenkDetailAuswählen">
                    <i class="bi bi-heart-fill me-1"></i>Geschenk auswählen
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Zusätzliche Schriftarten -->
<style>
    @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@300;400;500;600&family=Crimson+Text:ital,wght@0,400;0,600;1,400&display=swap');
    
    .text-elegant {
        font-family: 'Playfair Display', serif !important;
    }
    
    .btn-elegant:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(212, 175, 55, 0.3) !important;
    }
    
    /* Button hover effects for all elegant wedding buttons */
    .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(212, 175, 55, 0.4) !important;
        transition: all 0.3s ease;
    }

    /* Card hover effects */
    .card:hover {
        transform: translateY(-3px);
        transition: all 0.3s ease;
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15) !important;
    }
    
    /* Enhanced Tab Navigation Styles */
    .nav-pills .nav-link {
        transition: all 0.3s ease;
        border-radius: 8px !important;
        margin: 0.25rem;
        font-weight: 500;
    }
    
    /* Inactive Tab Style */
    .nav-pills .nav-link:not(.active) {
        background: transparent !important;
        border: 1px solid #d4af37 !important;
        color: #8b7355 !important;
    }
    
    /* Active Tab Style */
    .nav-pills .nav-link.active {
        background: linear-gradient(135deg, #d4af37, #f4e4bc) !important;
        border: none !important;
        color: #8b7355 !important;
        box-shadow: 0 4px 15px rgba(212, 175, 55, 0.4) !important;
        transform: translateY(-1px);
    }
    
    /* Hover Effects for Tabs */
    .nav-pills .nav-link:hover:not(.active) {
        background: linear-gradient(135deg, rgba(212, 175, 55, 0.1), rgba(244, 228, 188, 0.2)) !important;
        border-color: #d4af37 !important;
        color: #8b7355 !important;
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(212, 175, 55, 0.3);
    }
    
    .nav-pills .nav-link:hover.active {
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(212, 175, 55, 0.5) !important;
    }
    
    /* Navigation Hover Effects */
    .navbar-brand:hover {
        transform: translateY(-1px);
        transition: all 0.3s ease;
    }
    
    .btn-outline-secondary:hover {
        background: linear-gradient(135deg, #d4af37, #f4e4bc) !important;
        border-color: #d4af37 !important;
        color: #8b7355 !important;
        transform: translateY(-1px);
        transition: all 0.3s ease;
    }
    
    .invitation-card {
        position: relative;
        overflow: hidden;
    }
    
    .invitation-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="1" fill="%23f0f0f0" opacity="0.3"/></svg>') repeat;
        pointer-events: none;
        z-index: 0;
    }
    
    .invitation-card > * {
        position: relative;
        z-index: 1;
    }
    
    /* Kompakte Layout-Optimierungen */
    .row {
        margin-bottom: 0.5rem;
    }
    
    .card {
        margin-bottom: 0.75rem !important;
    }
    
    .container-fluid {
        padding-top: 0.5rem;
        padding-bottom: 0.5rem;
    }
    
    /* Karten-Buttons für Apple Maps und Google Maps */
    .btn-maps {
        transition: all 0.3s ease;
        font-weight: 500;
        position: relative;
        overflow: hidden;
    }
    
    /* === GUEST GALLERY MODERN STYLES === */
    
    /* Moderne Galerie-Karten mit verbessertem Design */
    .guest-gallery-item {
        position: relative;
        cursor: pointer;
        transition: all 0.4s cubic-bezier(0.23, 1, 0.32, 1);
        margin-bottom: 1.5rem;
        border-radius: 16px;
        overflow: hidden;
        box-shadow: 
            0 4px 16px rgba(0, 0, 0, 0.1),
            0 8px 32px rgba(0, 0, 0, 0.05);
        background: white;
        transform: translateY(0);
    }

    .guest-gallery-item:hover {
        transform: translateY(-12px) scale(1.02);
        box-shadow: 
            0 16px 40px rgba(0, 0, 0, 0.15),
            0 24px 64px rgba(0, 0, 0, 0.1);
    }

    /* Video-spezifische Hover-Effekte */
    .guest-gallery-item.video:hover {
        transform: translateY(-8px) scale(1.015);
        box-shadow: 
            0 20px 48px rgba(156, 39, 176, 0.2),
            0 12px 32px rgba(74, 144, 226, 0.15);
    }

    /* Responsive Karten-Layout */
    .guest-gallery-item .card {
        border: none;
        border-radius: 16px;
        overflow: hidden;
        height: 100%;
        min-height: 430px; /* Mindesthöhe für bessere Darstellung - +30px */
        display: flex;
        flex-direction: column;
        background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
    }

    .guest-gallery-item .card-body {
        padding: 0;
        height: 100%;
        display: flex;
        flex-direction: column;
    }

    /* Medien-Container mit festem Aspect Ratio */
    .guest-gallery-media-container {
        position: relative;
        width: 100%;
        aspect-ratio: 4/3;
        min-height: 310px; /* Mindesthöhe für bessere Sichtbarkeit - +30px für größere Fotos */
        overflow: hidden;
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 16px 16px 0 0;
    }

    /* Bilder Optimierungen */
    .guest-gallery-item img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: all 0.5s cubic-bezier(0.23, 1, 0.32, 1);
        max-width: 100%;
        max-height: 100%;
        display: block;
        min-height: 100%;
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        filter: contrast(1.05) saturate(1.1);
    }

    .guest-gallery-item:hover img {
        transform: scale(1.1);
        filter: contrast(1.1) saturate(1.2) brightness(1.05);
    }

    /* Verbesserter Hover Overlay für Bilder */
    .guest-media-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(135deg, 
            rgba(74, 144, 226, 0.8) 0%, 
            rgba(156, 39, 176, 0.8) 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        transition: all 0.4s cubic-bezier(0.23, 1, 0.32, 1);
        backdrop-filter: blur(8px);
    }

    .guest-overlay-content {
        text-align: center;
        color: white;
        transform: scale(0.8) translateY(20px);
        transition: all 0.4s cubic-bezier(0.23, 1, 0.32, 1);
    }

    .guest-overlay-content i {
        font-size: 3rem;
        margin-bottom: 0.5rem;
        display: block;
        filter: drop-shadow(0 4px 12px rgba(0, 0, 0, 0.3));
    }

    .guest-overlay-text {
        font-size: 1rem;
        font-weight: 600;
        letter-spacing: 0.5px;
        text-transform: uppercase;
        opacity: 0.9;
    }

    .guest-gallery-item:hover .guest-media-overlay {
        opacity: 1;
    }

    .guest-gallery-item:hover .guest-overlay-content {
        transform: scale(1) translateY(0);
    }

    /* Elegante Video-Container */
    .guest-video-container {
        width: 100%;
        height: 100%;
        position: relative;
        overflow: hidden;
        border-radius: 16px 16px 0 0;
    }

    .guest-video-preview {
        width: 100%;
        height: 100%;
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        position: relative;
        background-color: #2c3e50;
        transition: all 0.5s cubic-bezier(0.23, 1, 0.32, 1);
    }

    .guest-gallery-item:hover .guest-video-preview {
        transform: scale(1.05);
        filter: brightness(1.1) contrast(1.1);
    }

    /* Video Overlay Gradient */
    .guest-video-overlay-gradient {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(
            135deg, 
            rgba(74, 144, 226, 0.2) 0%, 
            rgba(156, 39, 176, 0.3) 50%,
            rgba(233, 30, 99, 0.2) 100%
        transition: all 0.4s ease;
        });
    }
    }

    .guest-gallery-item:hover .guest-video-overlay-gradient {
        background: linear-gradient(
            135deg, 
            rgba(74, 144, 226, 0.4) 0%, 
            rgba(156, 39, 176, 0.5) 50%,
            rgba(233, 30, 99, 0.4) 100%
        );
    }

    /* Animierter Play Button */
    .guest-video-play-button {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 3;
    }

    .guest-play-circle {
        width: 80px;
        height: 80px;
        background: linear-gradient(135deg, 
            rgba(255, 255, 255, 0.95) 0%, 
            rgba(255, 255, 255, 0.9) 100%);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
        box-shadow: 
            0 8px 32px rgba(0, 0, 0, 0.3),
            0 4px 16px rgba(156, 39, 176, 0.2);
        transition: all 0.4s cubic-bezier(0.23, 1, 0.32, 1);
        backdrop-filter: blur(20px);
        border: 3px solid rgba(255, 255, 255, 0.8);
    }

    .guest-play-circle i {
        font-size: 2rem;
        color: #6c5ce7;
        margin-left: 3px; /* Leicht nach rechts versetzt für optische Balance */
        transition: all 0.3s ease;
    }

    .guest-gallery-item:hover .guest-play-circle {
        transform: scale(1.15);
        background: linear-gradient(135deg, 
            rgba(255, 255, 255, 1) 0%, 
            rgba(255, 255, 255, 0.95) 100%);
        box-shadow: 
            0 16px 48px rgba(0, 0, 0, 0.4),
            0 8px 24px rgba(156, 39, 176, 0.3);
    }

    .guest-gallery-item:hover .guest-play-circle i {
        color: #5f3dc4;
        transform: scale(1.1);
    }

    /* Ripple Effekt */
    .guest-play-ripple {
        position: absolute;
        top: 50%;
        left: 50%;
        width: 80px;
        height: 80px;
        border: 2px solid rgba(255, 255, 255, 0.6);
        border-radius: 50%;
        transform: translate(-50%, -50%);
        animation: guest-ripple 2s infinite;
        z-index: 1;
    }

    @keyframes guest-ripple {
        0% {
            transform: translate(-50%, -50%) scale(1);
            opacity: 0.8;
        }
        70% {
            transform: translate(-50%, -50%) scale(1.8);
            opacity: 0;
        }
        100% {
            transform: translate(-50%, -50%) scale(1.8);
            opacity: 0;
        }
    }

    /* Video Type Badge */
    .guest-video-type-badge {
        position: absolute;
        top: 1rem;
        left: 1rem;
        background: linear-gradient(135deg, 
            rgba(74, 144, 226, 0.95) 0%, 
            rgba(156, 39, 176, 0.95) 100%);
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 25px;
        font-size: 0.8rem;
        font-weight: 600;
        display: flex;
        align-items: center;
        backdrop-filter: blur(20px);
        box-shadow: 0 4px 16px rgba(74, 144, 226, 0.3);
        transition: all 0.3s ease;
        z-index: 2;
    }

    .guest-gallery-item:hover .guest-video-type-badge {
        transform: translateY(-2px) scale(1.05);
        box-shadow: 0 8px 24px rgba(74, 144, 226, 0.4);
    }

    /* Video Duration Corner */
    .guest-video-duration-corner {
        position: absolute;
        top: 1rem;
        right: 1rem;
        width: 40px;
        height: 40px;
        background: rgba(0, 0, 0, 0.8);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 0.9rem;
        backdrop-filter: blur(10px);
        transition: all 0.3s ease;
        z-index: 2;
    }

    .guest-gallery-item:hover .guest-video-duration-corner {
        background: rgba(0, 0, 0, 0.9);
        transform: scale(1.1);
    }

    /* Informations-Container */
    .guest-gallery-info {
        padding: 1.25rem;
        flex-grow: 1;
        display: flex;
        flex-direction: column;
        justify-content: center;
        text-align: center;
        background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
        border-radius: 0 0 16px 16px;
        transition: all 0.3s ease;
    }

    .guest-gallery-item:hover .guest-gallery-info {
        background: linear-gradient(135deg, #ffffff 0%, #f1f3f4 100%);
        transform: translateY(-2px);
    }

    .guest-gallery-author {
        font-size: 1rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
        line-height: 1.3;
        transition: all 0.3s ease;
    }

    .guest-brautpaar-name {
        font-family: 'Playfair Display', serif !important;
        font-weight: 600;
        font-size: 1.2rem;
        color: #000000 !important;
        letter-spacing: 1px;
        position: relative;
        text-transform: uppercase;
        font-style: italic;
    }

    .guest-guest-name {
        color: #495057;
        font-weight: 600;
    }

    .guest-gallery-date {
        font-size: 0.85rem;
        color: #6c757d;
        font-weight: 500;
        opacity: 0.8;
        transition: all 0.3s ease;
    }

    .guest-gallery-item:hover .guest-gallery-date {
        opacity: 1;
        color: #5a6c7d;
    }

    /* Fullscreen Modal Optimierungen für Guest Gallery */

    /* Vollbild Media Darstellung - Deutlich kleinere zentrierte Ansicht */
    .guest-fullscreen-media {
        max-height: 75vh !important; /* 75% der Bildschirmhöhe verwenden */
        max-width: 75vw !important; /* 75% der Bildschirmbreite verwenden */
        width: auto !important;
        height: auto !important;
        object-fit: contain !important;
        border-radius: 16px !important; /* Größere abgerundete Ecken */
        box-shadow: 0 12px 48px rgba(0, 0, 0, 0.7) !important; /* Stärkerer Schatten für bessere Sichtbarkeit */
    }

    /* Custom Close Button (floating top-right) */
    .guest-custom-close-btn {
        background: rgba(0, 0, 0, 0.6);
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        width: 48px;
        height: 48px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.2rem;
        font-weight: 600;
        transition: all 0.3s ease;
        backdrop-filter: blur(20px);
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.4);
        cursor: pointer;
    }

    .guest-custom-close-btn:hover {
        background: rgba(0, 0, 0, 0.8);
        border-color: rgba(255, 255, 255, 0.5);
        color: white;
        transform: scale(1.1);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.5);
    }

    .guest-custom-close-btn:focus {
        outline: none;
        box-shadow: 
            0 6px 20px rgba(0, 0, 0, 0.5),
            0 0 0 3px rgba(255, 255, 255, 0.3);
    }

    /* Navigation Buttons Verbesserung */
    .guest-nav-btn {
        background: rgba(255, 255, 255, 0.15) !important;
        border: 2px solid rgba(255, 255, 255, 0.25) !important;
        backdrop-filter: blur(20px);
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
        width: 60px;
        height: 60px;
        border-radius: 50% !important;
        font-size: 1.4rem;
        transition: all 0.3s cubic-bezier(0.23, 1, 0.32, 1);
    }

    .guest-nav-btn:hover {
        background: rgba(255, 255, 255, 0.25) !important;
        border-color: rgba(255, 255, 255, 0.4) !important;
        transform: translateY(-50%) scale(1.15);
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
    }

    .guest-nav-btn:focus {
        outline: none;
        box-shadow: 
            0 8px 24px rgba(0, 0, 0, 0.4),
            0 0 0 3px rgba(255, 255, 255, 0.3);
    }

    /* Modal Action Buttons */
    .guest-modal-action-btn {
        background: rgba(255, 255, 255, 0.15) !important;
        border: 2px solid rgba(255, 255, 255, 0.25) !important;
        backdrop-filter: blur(20px);
        transition: all 0.3s ease;
        font-weight: 500;
    }

    .guest-modal-action-btn:hover {
        background: rgba(255, 255, 255, 0.25) !important;
        border-color: rgba(255, 255, 255, 0.4) !important;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }

    /* Auto-hide für bessere Bildbetrachtung */
    #guestFullscreenModal.auto-hide .modal-footer,
    #guestFullscreenModal.auto-hide .guest-custom-close-btn {
        opacity: 0;
        pointer-events: none;
    }

    #guestFullscreenModal.auto-hide .guest-nav-btn {
        opacity: 0.3;
    }

    #guestFullscreenModal:hover .modal-footer,
    #guestFullscreenModal:hover .guest-custom-close-btn,
    #guestFullscreenModal:hover .guest-nav-btn {
        opacity: 1;
        pointer-events: auto;
    }

    /* Responsive fullscreen adjustments */
    @media (max-width: 768px) {
        .guest-fullscreen-media {
            max-height: 68vh !important;
            max-width: 85vw !important;
        }
        
        .guest-nav-btn {
            width: 50px !important;
            height: 50px !important;
            font-size: 1.2rem !important;
        }
        
        #guestPrevBtn {
            left: 15px !important;
        }
        
        #guestNextBtn {
            right: 15px !important;
        }
        
        .guest-custom-close-btn {
            width: 42px;
            height: 42px;
            font-size: 1rem;
        }
        
        .guest-modal-action-btn {
            font-size: 0.9rem;
            padding: 0.5rem 1rem;
        }
    }

    @media (max-width: 375px) {
        .guest-fullscreen-media {
            max-height: 60vh !important;
            max-width: 85vw !important;
        }
    }

    @media (max-width: 768px) and (orientation: landscape) {
        .guest-fullscreen-media {
            max-height: 75vh !important;
            max-width: 70vw !important;
        }
    }

    @media (min-width: 769px) and (max-width: 1024px) {
        .guest-fullscreen-media {
            max-height: 72vh !important;
            max-width: 75vw !important;
        }
    }

    /* FORCE OVERRIDE für Guest Gallery */
    #guestFullscreenImage.guest-fullscreen-media,
    #guestFullscreenVideo.guest-fullscreen-media,
    img.guest-fullscreen-media,
    video.guest-fullscreen-media {
        max-height: 75vh !important;
        max-width: 75vw !important;
        width: auto !important;
        height: auto !important;
        object-fit: contain !important;
        border-radius: 16px !important;
        box-shadow: 0 12px 48px rgba(0, 0, 0, 0.7) !important;
    }

    @media (max-width: 768px) {
        #guestFullscreenImage.guest-fullscreen-media,
        #guestFullscreenVideo.guest-fullscreen-media,
        img.guest-fullscreen-media,
        video.guest-fullscreen-media {
            max-height: 68vh !important;
            max-width: 85vw !important;
        }
    }
    
    /* === END GUEST GALLERY STYLES === */
    
    .btn-maps:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }
    
    /* Apple Maps Button */
    .btn-apple-maps:hover {
        background: rgba(0, 122, 255, 0.15) !important;
        border-color: rgba(0, 122, 255, 0.3) !important;
    }
    
    /* Google Maps Button */  
    .btn-google-maps:hover {
        background: rgba(234, 67, 53, 0.15) !important;
        border-color: rgba(234, 67, 53, 0.3) !important;
    }
    
    /* Map Icons Styling */
    .btn-maps img {
        transition: all 0.3s ease;
        filter: brightness(1);
    }
    
    .btn-maps:hover img {
        filter: brightness(1.2);
        transform: scale(1.1);
    }
    
    /* Icon fallbacks für bessere Browser-Kompatibilität */
    .bi-apple:before {
        content: "🍎";
        font-style: normal;
        font-family: "Apple Color Emoji", "Segoe UI Emoji", "Noto Color Emoji", sans-serif;
    }
    
    .bi-google:before {
        content: "🔍";
        font-style: normal;  
        font-family: "Apple Color Emoji", "Segoe UI Emoji", "Noto Color Emoji", sans-serif;
    }

    /* Responsive Tabellen-Design für mobile Geräte */
    @media screen and (max-width: 768px) {
        .table-responsive table,
        .table-responsive thead,
        .table-responsive tbody,
        .table-responsive th,
        .table-responsive td,
        .table-responsive tr {
            display: block;
        }

        .table-responsive thead tr {
            position: absolute;
            top: -9999px;
            left: -9999px;
        }

        .table-responsive tr {
            background: white;
            border: 1px solid var(--wedding-gold);
            border-radius: 12px;
            margin-bottom: 15px;
            padding: 15px;
            box-shadow: 0 2px 10px rgba(212, 175, 55, 0.1);
        }

        .table-responsive td {
            border: none !important;
            position: relative;
            padding: 8px 0 !important;
            margin-bottom: 10px;
            display: flex !important;
            justify-content: space-between;
            align-items: center;
        }

        .table-responsive td:before {
            content: attr(data-label) ": ";
            font-weight: bold;
            color: var(--wedding-gold);
            min-width: 80px;
            flex-shrink: 0;
            font-size: 0.9rem;
        }

        .table-responsive td:last-child {
            margin-bottom: 0;
        }

        /* Spezielle Styles für Action-Buttons */
        .table-responsive td[data-label="Aktion"] {
            margin-top: 10px;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }

        .table-responsive td[data-label="Aktion"]:before {
            display: none;
        }

        .table-responsive td[data-label="Aktion"] button {
            width: 100% !important;
            padding: 12px !important;
            font-size: 1rem !important;
        }

        /* Geschenk-Name hervorheben */
        .table-responsive td[data-label="Geschenk"] {
            background-color: #f8f9fa;
            margin: -15px -15px 10px -15px;
            padding: 15px !important;
            border-radius: 12px 12px 0 0;
        }

        .table-responsive td[data-label="Geschenk"]:before {
            display: none;
        }

        /* Badge-Styles für mobile */
        .table-responsive .badge {
            font-size: 0.85rem;
            padding: 6px 12px;
        }
    }

    /* Touch-friendly Buttons für mobile */
    @media screen and (max-width: 768px) {
        .btn-sm {
            padding: 10px 16px !important;
            font-size: 0.95rem !important;
            min-height: 44px;
        }
    }
</style>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/first_login_modal.js') }}"></script>
<script src="{{ url_for('static', filename='js/guest_dashboard.js') }}"></script>
<script src="{{ url_for('static', filename='js/guest_uploads.js') }}"></script>

<script>
// Gäste-Galerie JavaScript - Robuste Implementierung für Tab-System

window.guestGalleryData = []; // Store gallery data for navigation
window.guestCurrentIndex = -1; // Current item index
window.guestGalleryLoaded = false; // Flag to prevent multiple loads

// Galerie-Laden Funktion
window.loadGuestGalleryNow = function() {
    // Warten bis DOM-Elemente verfügbar sind
    const loading = document.getElementById('guestGalleryLoading');
    const container = document.getElementById('guestGalleryContainer');
    
    if (!loading || !container) {
        setTimeout(loadGuestGalleryNow, 100);
        return;
    }
    
    // Vermeiden von mehrfachen gleichzeitigen Loads
    if (window.guestGalleryLoaded) {
        return;
    }
    
    window.guestGalleryLoaded = true;
    
    // Zeige Loading-Animation
    loading.style.display = 'block';
    container.innerHTML = '';
    
    fetch('/api/approved-gallery')
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            }
            return response.json();
        })
        .then(data => {
            // Store gallery data for navigation
            window.guestGalleryData = data || [];
            
            loading.style.display = 'none';
            
            if (data && data.length > 0) {
                renderGuestGallery(data);
            } else {
                container.innerHTML = `
                    <div class="col-12">
                        <div class="text-center py-5">
                            <i class="bi bi-images" style="font-size: 4rem; color: #d4af37; opacity: 0.5;"></i>
                            <h5 class="mt-3" style="color: #8b7355;">Noch keine Fotos</h5>
                            <p class="text-muted">Es wurden noch keine Fotos für die Galerie freigegeben.</p>
                        </div>
                    </div>
                `;
            }
        })
        .catch(error => {
            loading.style.display = 'none';
            container.innerHTML = `
                <div class="col-12">
                    <div class="alert alert-danger">
                        <h5>❌ Fehler beim Laden der Galerie</h5>
                        <p><strong>Fehlermeldung:</strong> ${error.message}</p>
                        <p><strong>Zeitpunkt:</strong> ${new Date().toLocaleString('de-DE')}</p>
                        <button class="btn btn-outline-danger btn-sm" onclick="location.reload()">
                            <i class="bi bi-arrow-clockwise me-1"></i>Seite neu laden
                        </button>
                    </div>
                </div>
            `;
            window.guestGalleryLoaded = false; // Reset flag on error
        });
}

// Refresh-Funktion für Guest Gallery
window.refreshGuestGallery = function() {
    window.guestGalleryLoaded = false;
    window.guestGalleryData = [];
    window.loadGuestGalleryNow();
}

// Render-Funktion für Guest Gallery
function renderGuestGallery(data) {
    const container = document.getElementById('guestGalleryContainer');
    if (!container) return;
    
    let html = '';
    data.forEach((upload) => {
        const fileTypeClass = upload.file_type === 'image' ? 'image' : 'video';
        
        // Enhanced displayName logic - treat Administrator as Brautpaar
        let displayName;
        if (upload.gast_vorname && upload.gast_nachname) {
            displayName = `${upload.gast_vorname} ${upload.gast_nachname}`;
        } else if (upload.gast_vorname === 'Administrator' || upload.gast_vorname === 'Brautpaar') {
            displayName = 'Brautpaar';
        } else {
            displayName = 'Brautpaar'; // Default to Brautpaar instead of Unbekannt
        }
        
        // Check if it's from Brautpaar
        const isBrautpaar = displayName === 'Brautpaar';
        const authorDisplay = isBrautpaar ? 
            `<span class="guest-brautpaar-name">👰🏻‍♀️🤵🏻‍♂️ Brautpaar</span>` : 
            `<span class="guest-guest-name">${displayName}</span>`;
        
        const uploadDate = new Date(upload.upload_date).toLocaleDateString('de-DE', {
            day: '2-digit',
            month: '2-digit',
            year: 'numeric'
        });
        
        html += `
            <div class="col-lg-3 col-md-4 col-sm-6 col-12">
                <div class="guest-gallery-item ${fileTypeClass}" onclick="openGuestFullscreen(${upload.id}, ${JSON.stringify(upload.file_type)}, ${JSON.stringify(upload.original_filename)}, ${JSON.stringify(displayName)}, ${JSON.stringify(uploadDate)})">
                    <div class="card">
                        <div class="card-body">
                            <div class="guest-gallery-media-container">
                                ${upload.file_type === 'image' ? `
                                    <img src="/api/gallery-thumbnail/${upload.id}" alt="${upload.original_filename}" loading="lazy">
                                    <div class="guest-media-overlay">
                                        <div class="guest-overlay-content">
                                            <i class="bi bi-zoom-in"></i>
                                            <span class="guest-overlay-text">Ansehen</span>
                                        </div>
                                    </div>
                                ` : `
                                    <div class="guest-video-container">
                                        <div class="guest-video-preview" style="background-image: linear-gradient(45deg, rgba(74, 144, 226, 0.1), rgba(156, 39, 176, 0.1)), url('/api/gallery-thumbnail/${upload.id}');">
                                            <div class="guest-video-overlay-gradient"></div>
                                            <div class="guest-video-play-button">
                                                <div class="guest-play-circle">
                                                    <i class="bi bi-play-fill"></i>
                                                </div>
                                                <div class="guest-play-ripple"></div>
                                            </div>
                                            <div class="guest-video-type-badge">
                                                <i class="bi bi-camera-video-fill me-1"></i>
                                                <span>Video</span>
                                            </div>
                                            <div class="guest-video-duration-corner">
                                                <i class="bi bi-clock-fill"></i>
                                            </div>
                                        </div>
                                    </div>
                                `}
                            </div>
                            <div class="guest-gallery-info">
                                <div class="guest-gallery-author ${isBrautpaar ? 'guest-brautpaar-name' : 'guest-guest-name'}">
                                    ${authorDisplay}
                                </div>
                                <div class="guest-gallery-date">${uploadDate}</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `;
    });
    container.innerHTML = html;
}

// Enhanced Multi-Strategy Loading Approach

// Strategy 0: Immediate DOM check
function attemptImmediateLoad() {
    // Check if gallery tab is currently visible/active
    const galleryPane = document.getElementById('gallery-pane');
    if (galleryPane) {
        const isVisible = galleryPane.classList.contains('show') || galleryPane.classList.contains('active');


        
        if (isVisible && !guestGalleryLoaded) {
            loadGuestGalleryNow();
            return;
        }
    }
    
    if (!guestGalleryLoaded) {
        loadGuestGalleryNow();
    }
}

// Try immediate load
setTimeout(attemptImmediateLoad, 10);

// Strategy 2: Enhanced Tab-aktivierung mit besserer Event-Detection
document.addEventListener('DOMContentLoaded', function() {
    const galleryTab = document.getElementById('gallery-tab');
    const galleryPane = document.getElementById('gallery-pane');
    
    if (galleryTab) {
        // Enhanced Bootstrap tab event listener
        galleryTab.addEventListener('shown.bs.tab', function (e) {



            loadGuestGalleryNow();
        });
        
        // ENHANCED click event listener - trigger immediately on click
        galleryTab.addEventListener('click', function(e) {



            
            // IMMEDIATE load attempt - don't wait for tab switch

            setTimeout(() => {
                loadGuestGalleryNow();
            }, 100); // Very short delay to ensure DOM is ready
        });
        
        // Check if gallery tab is already active on load
        const isActive = galleryTab.classList.contains('active') || 
                         galleryTab.getAttribute('aria-selected') === 'true';
        
        if (isActive) {

            setTimeout(() => {
                loadGuestGalleryNow();
            }, 100);
        }
    } else {

    }
    
    // UNIVERSAL Tab Observer - watches for any tab changes
    const tabObserver = new MutationObserver(function(mutations) {
        mutations.forEach(function(mutation) {
            if (mutation.type === 'attributes' && 
                mutation.attributeName === 'class' || 
                mutation.attributeName === 'aria-selected') {
                
                const target = mutation.target;
                if (target.id === 'gallery-tab' || target.getAttribute('data-bs-target') === '#gallery-pane') {
                    const isNowActive = target.classList.contains('active') || 
                                       target.getAttribute('aria-selected') === 'true';
                    
                    if (isNowActive) {

                        setTimeout(() => {
                            loadGuestGalleryNow();
                        }, 200);
                    }
                }
            }
        });
    });
    
    // Start observing tab changes
    if (galleryTab) {
        tabObserver.observe(galleryTab, {
            attributes: true,
            attributeFilter: ['class', 'aria-selected']
        });
    }
    
    // Strategy 3: Multiple force loading attempts with increasing delays
    const forceLoadingAttempts = [500, 1000, 2000];
    forceLoadingAttempts.forEach((delay, index) => {
        setTimeout(() => {
            if (!guestGalleryLoaded) {

                loadGuestGalleryNow();
            }
        }, delay);
    });
    
    // Strategy 4: Enhanced Global Tab Switch Detection
    document.body.addEventListener('click', function(e) {
        // Check if any gallery-related element was clicked
        const target = e.target;
        const isGalleryClick = target.id === 'gallery-tab' || 
                              target.getAttribute('data-bs-target') === '#gallery-pane' ||
                              target.closest('#gallery-tab') ||
                              target.closest('[data-bs-target="#gallery-pane"]');
        
        if (isGalleryClick) {


            setTimeout(() => {

                loadGuestGalleryNow();
            }, 150);
        }
    });
});

// Fullscreen modal functions
window.openGuestFullscreen = function(uploadId, fileType, filename, guestName, uploadDate) {
    
    // Find current index in gallery data
    window.guestCurrentIndex = window.guestGalleryData.findIndex(item => item.id === uploadId);
    
    const modal = new bootstrap.Modal(document.getElementById('guestFullscreenModal'));
    const modalUploadInfo = document.getElementById('guestModalUploadInfo');
    const fullscreenImage = document.getElementById('guestFullscreenImage');
    const fullscreenVideo = document.getElementById('guestFullscreenVideo');
    const prevBtn = document.getElementById('guestPrevBtn');
    const nextBtn = document.getElementById('guestNextBtn');
    
    // Set only upload info (no title, no filename)
    modalUploadInfo.textContent = `Hochgeladen von ${guestName} am ${uploadDate}`;
    
    if (fileType === 'image') {
        // Show image
        fullscreenImage.src = `/api/gallery-image/${uploadId}`;
        fullscreenImage.alt = filename;
        fullscreenImage.classList.remove('d-none');
        fullscreenVideo.classList.add('d-none');
        
        // FORCE SMALL SIZE - Direkte Style-Zuweisung
        fullscreenImage.style.maxHeight = '75vh';
        fullscreenImage.style.maxWidth = '75vw';
        fullscreenImage.style.width = 'auto';
        fullscreenImage.style.height = 'auto';
        fullscreenImage.style.objectFit = 'contain';
        fullscreenImage.style.borderRadius = '16px';
        fullscreenImage.style.boxShadow = '0 12px 48px rgba(0, 0, 0, 0.7)';
        
        // Ensure proper loading and sizing
        fullscreenImage.onload = function() {

            // FORCE AGAIN after loading
            this.style.maxHeight = '75vh';
            this.style.maxWidth = '75vw';
            this.style.width = 'auto';
            this.style.height = 'auto';
            this.style.objectFit = 'contain';
            this.style.borderRadius = '16px';
            this.style.boxShadow = '0 12px 48px rgba(0, 0, 0, 0.7)';
        };
    } else {
        // Show video
        fullscreenVideo.src = `/api/gallery-image/${uploadId}`;
        fullscreenVideo.classList.remove('d-none');
        fullscreenImage.classList.add('d-none');
        
        // FORCE SMALL SIZE - Direkte Style-Zuweisung für Video
        fullscreenVideo.style.maxHeight = '75vh';
        fullscreenVideo.style.maxWidth = '75vw';
        fullscreenVideo.style.width = 'auto';
        fullscreenVideo.style.height = 'auto';
        fullscreenVideo.style.objectFit = 'contain';
        fullscreenVideo.style.borderRadius = '16px';
        fullscreenVideo.style.boxShadow = '0 12px 48px rgba(0, 0, 0, 0.7)';
        
        // Ensure video is properly configured for mobile
        fullscreenVideo.setAttribute('playsinline', '');
        fullscreenVideo.setAttribute('webkit-playsinline', '');
    }
    
    // Update navigation buttons
    prevBtn.style.display = window.guestCurrentIndex > 0 ? 'block' : 'none';
    nextBtn.style.display = window.guestCurrentIndex < window.guestGalleryData.length - 1 ? 'block' : 'none';
    
    // Store current file info for download
    window.guestCurrentFile = { id: uploadId, filename: filename, type: fileType };
    
    // ULTIMATE FORCE SIZE - Interval timer to ensure size stays small
    const sizeForceInterval = setInterval(() => {
        const img = document.getElementById('guestFullscreenImage');
        const vid = document.getElementById('guestFullscreenVideo');
        
        if (img && !img.classList.contains('d-none')) {
            img.style.maxHeight = '75vh';
            img.style.maxWidth = '75vw';
            img.style.width = 'auto';
            img.style.height = 'auto';
            img.style.objectFit = 'contain';
            img.style.borderRadius = '16px';
            img.style.boxShadow = '0 12px 48px rgba(0, 0, 0, 0.7)';
        }
        
        if (vid && !vid.classList.contains('d-none')) {
            vid.style.maxHeight = '75vh';
            vid.style.maxWidth = '75vw';
            vid.style.width = 'auto';
            vid.style.height = 'auto';
            vid.style.objectFit = 'contain';
            vid.style.borderRadius = '16px';
            vid.style.boxShadow = '0 12px 48px rgba(0, 0, 0, 0.7)';
        }
    }, 100);
    
    // Store interval for cleanup
    window.guestCurrentSizeForceInterval = sizeForceInterval;
    
    modal.show();
};

window.closeGuestFullscreen = function() {

    
    // Clear focus from any buttons before hiding
    if (document.activeElement && document.activeElement.blur) {
        document.activeElement.blur();
    }
    
    const modal = bootstrap.Modal.getInstance(document.getElementById('guestFullscreenModal'));
    if (modal) {

        modal.hide();
    } else {

        // Fallback: manually hide modal
        const modalElement = document.getElementById('guestFullscreenModal');
        if (modalElement) {
            modalElement.style.display = 'none';
            modalElement.classList.remove('show');
            modalElement.setAttribute('aria-hidden', 'true');
            
            // Remove ALL backdrops
            const backdrops = document.querySelectorAll('.modal-backdrop');
            backdrops.forEach(backdrop => {

                backdrop.remove();
            });
            
            // Restore body scroll and state
            document.body.classList.remove('modal-open');
            document.body.style.overflow = '';
            document.body.style.paddingRight = '';
            

        }
    }
    
    // Additional safety timeout to force cleanup
    setTimeout(function() {
        const remainingBackdrops = document.querySelectorAll('.modal-backdrop');
        if (remainingBackdrops.length > 0) {

            remainingBackdrops.forEach(backdrop => backdrop.remove());
            document.body.classList.remove('modal-open');
            document.body.style.overflow = '';
            document.body.style.paddingRight = '';
        }
    }, 300);
};

window.downloadGuestFile = function() {
    if (window.guestCurrentFile) {
        const link = document.createElement('a');
        link.href = `/api/gallery-image/${window.guestCurrentFile.id}`;
        link.download = window.guestCurrentFile.filename;
        link.click();
    }
};

window.showGuestPrevious = function() {
    if (window.guestCurrentIndex > 0) {
        const prevItem = window.guestGalleryData[guestCurrentIndex - 1];
        
        // Enhanced displayName logic - treat Administrator as Brautpaar
        let prevDisplayName;
        if (prevItem.gast_vorname && prevItem.gast_nachname) {
            prevDisplayName = `${prevItem.gast_vorname} ${prevItem.gast_nachname}`;
        } else if (prevItem.gast_vorname === 'Administrator' || prevItem.gast_vorname === 'Brautpaar') {
            prevDisplayName = 'Brautpaar';
        } else {
            prevDisplayName = 'Brautpaar'; // Default to Brautpaar instead of Unbekannt
        }
        const uploadDate = new Date(prevItem.upload_date).toLocaleDateString('de-DE', {
            day: '2-digit',
            month: '2-digit',
            year: 'numeric'
        });
        window.openGuestFullscreen(prevItem.id, prevItem.file_type, prevItem.original_filename, 
                            prevDisplayName, uploadDate);
    }
};

window.showGuestNext = function() {
    if (window.guestCurrentIndex < window.guestGalleryData.length - 1) {
        const nextItem = window.guestGalleryData[guestCurrentIndex + 1];
        
        // Enhanced displayName logic - treat Administrator as Brautpaar
        let nextDisplayName;
        if (nextItem.gast_vorname && nextItem.gast_nachname) {
            nextDisplayName = `${nextItem.gast_vorname} ${nextItem.gast_nachname}`;
        } else if (nextItem.gast_vorname === 'Administrator' || nextItem.gast_vorname === 'Brautpaar') {
            nextDisplayName = 'Brautpaar';
        } else {
            nextDisplayName = 'Brautpaar'; // Default to Brautpaar instead of Unbekannt
        }
        const uploadDate = new Date(nextItem.upload_date).toLocaleDateString('de-DE', {
            day: '2-digit',
            month: '2-digit',
            year: 'numeric'
        });
        window.openGuestFullscreen(nextItem.id, nextItem.file_type, nextItem.original_filename, 
                            nextDisplayName, uploadDate);
    }
};

window.filterGuestGallery = function() {
    const searchTerm = document.getElementById('guestGallerySearch').value.toLowerCase();
    const typeFilter = document.getElementById('guestGalleryTypeFilter').value;
    
    if (!searchTerm && !typeFilter) {
        // No filters, show all
        renderFilteredGuestGallery(window.guestGalleryData);
        return;
    }
    
    const filtered = window.guestGalleryData.filter(photo => {
        const matchesSearch = !searchTerm || 
                            photo.original_filename.toLowerCase().includes(searchTerm) ||
                            (photo.beschreibung && photo.beschreibung.toLowerCase().includes(searchTerm)) ||
                            `${photo.gast_vorname} ${photo.gast_nachname}`.toLowerCase().includes(searchTerm);
        
        const matchesType = !typeFilter || photo.file_type === typeFilter;
        
        return matchesSearch && matchesType;
    });
    
    renderFilteredGuestGallery(filtered);
};

function renderFilteredGuestGallery(filteredData) {
    const container = document.getElementById('guestGalleryContainer');
    const noPhotosMessage = document.getElementById('guestGalleryNoPhotos');
    
    if (filteredData.length === 0) {
        container.innerHTML = '';
        noPhotosMessage.classList.remove('d-none');
        return;
    }
    
    noPhotosMessage.classList.add('d-none');
    
    let html = '';
    filteredData.forEach((upload) => {
        const fileTypeClass = upload.file_type === 'image' ? 'image' : 'video';
        
        // Enhanced displayName logic - treat Administrator as Brautpaar
        let displayName;
        if (upload.gast_vorname && upload.gast_nachname) {
            displayName = `${upload.gast_vorname} ${upload.gast_nachname}`;
        } else if (upload.gast_vorname === 'Administrator' || upload.gast_vorname === 'Brautpaar') {
            displayName = 'Brautpaar';
        } else {
            displayName = 'Brautpaar'; // Default to Brautpaar instead of Unbekannt
        }
        
        // Check if it's from Brautpaar
        const isBrautpaar = displayName === 'Brautpaar';
        const authorDisplay = isBrautpaar ? 
            `<span class="guest-brautpaar-name">👰🏻‍♀️🤵🏻‍♂️ Brautpaar</span>` : 
            `<span class="guest-guest-name">${displayName}</span>`;
        
        const uploadDate = new Date(upload.upload_date).toLocaleDateString('de-DE', {
            day: '2-digit',
            month: '2-digit',
            year: 'numeric'
        });
        
        html += `
            <div class="col-lg-3 col-md-4 col-sm-6 col-12">
                <div class="guest-gallery-item ${fileTypeClass}" onclick="openGuestFullscreen(${upload.id}, ${JSON.stringify(upload.file_type)}, ${JSON.stringify(upload.original_filename)}, ${JSON.stringify(displayName)}, ${JSON.stringify(uploadDate)})">
                    <div class="card">
                        <div class="card-body">
                            <div class="guest-gallery-media-container">
                                ${upload.file_type === 'image' ? `
                                    <img src="/api/gallery-thumbnail/${upload.id}" alt="${upload.original_filename}" loading="lazy">
                                    <div class="guest-media-overlay">
                                        <div class="guest-overlay-content">
                                            <i class="bi bi-zoom-in"></i>
                                            <span class="guest-overlay-text">Ansehen</span>
                                        </div>
                                    </div>
                                ` : `
                                    <div class="guest-video-container">
                                        <div class="guest-video-preview" style="background-image: linear-gradient(45deg, rgba(74, 144, 226, 0.1), rgba(156, 39, 176, 0.1)), url('/api/gallery-thumbnail/${upload.id}');">
                                            <div class="guest-video-overlay-gradient"></div>
                                            <div class="guest-video-play-button">
                                                <div class="guest-play-circle">
                                                    <i class="bi bi-play-fill"></i>
                                                </div>
                                                <div class="guest-play-ripple"></div>
                                            </div>
                                            <div class="guest-video-type-badge">
                                                <i class="bi bi-camera-video-fill me-1"></i>
                                                <span>Video</span>
                                            </div>
                                            <div class="guest-video-duration-corner">
                                                <i class="bi bi-clock-fill"></i>
                                            </div>
                                        </div>
                                    </div>
                                `}
                            </div>
                            <div class="guest-gallery-info">
                                <div class="guest-gallery-author ${isBrautpaar ? 'guest-brautpaar-name' : 'guest-guest-name'}">
                                    ${authorDisplay}
                                </div>
                                <div class="guest-gallery-date">${uploadDate}</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `;
    });
    container.innerHTML = html;
}

// Keyboard navigation for guest modal
document.addEventListener('keydown', function(e) {
    const modal = document.getElementById('guestFullscreenModal');
    if (modal && modal.classList.contains('show')) {
        switch(e.key) {
            case 'ArrowLeft':
                e.preventDefault();
                if (window.guestCurrentIndex > 0) window.showGuestPrevious();
                break;
            case 'ArrowRight':
                e.preventDefault();
                if (window.guestCurrentIndex < window.guestGalleryData.length - 1) window.showGuestNext();
                break;
            case 'Escape':
                e.preventDefault();
                closeGuestFullscreen();
                break;
        }
    }
});

// Touch/swipe navigation for mobile on guest modal
let guestTouchStartX = 0;
let guestTouchEndX = 0;

document.addEventListener('touchstart', function(e) {
    const modal = document.getElementById('guestFullscreenModal');
    if (modal && modal.classList.contains('show')) {
        guestTouchStartX = e.changedTouches[0].screenX;
    }
});

document.addEventListener('touchend', function(e) {
    const modal = document.getElementById('guestFullscreenModal');
    if (modal && modal.classList.contains('show')) {
        guestTouchEndX = e.changedTouches[0].screenX;
        handleGuestSwipe();
    }
});

function handleGuestSwipe() {
    const swipeThreshold = 50; // Minimum swipe distance
    const swipeDistance = guestTouchEndX - guestTouchStartX;
    
    if (Math.abs(swipeDistance) > swipeThreshold) {
        if (swipeDistance > 0 && window.guestCurrentIndex > 0) {
            // Swipe right - show previous
            window.showGuestPrevious();
        } else if (swipeDistance < 0 && window.guestCurrentIndex < window.guestGalleryData.length - 1) {
            // Swipe left - show next
            window.showGuestNext();
        }
    }
}

// Modal event listeners for proper cleanup
document.addEventListener('DOMContentLoaded', function() {
    const modal = document.getElementById('guestFullscreenModal');
    if (modal) {
        // Auto-hide feature für bessere Bildbetrachtung
        let hideTimeout;
        
        const showControls = () => {
            modal.classList.remove('auto-hide');
            clearTimeout(hideTimeout);
            hideTimeout = setTimeout(() => {
                modal.classList.add('auto-hide');
            }, 3000); // Hide after 3 seconds of inactivity
        };
        
        const hideControls = () => {
            modal.classList.add('auto-hide');
        };
        
        // Show controls on mouse move or touch
        modal.addEventListener('mousemove', showControls);
        modal.addEventListener('touchstart', showControls);
        modal.addEventListener('click', showControls);
        
        // Always show controls when hovering over them
        const controls = modal.querySelectorAll('.modal-footer, .guest-nav-btn, .guest-custom-close-btn');
        controls.forEach(control => {
            control.addEventListener('mouseenter', () => {
                modal.classList.remove('auto-hide');
                clearTimeout(hideTimeout);
            });
        });
        
        // Clean up when modal is hidden
        modal.addEventListener('hidden.bs.modal', function () {

            // Reset auto-hide state
            modal.classList.remove('auto-hide');
            clearTimeout(hideTimeout);
            
            // Force remove any remaining backdrops
            const backdrops = document.querySelectorAll('.modal-backdrop');
            backdrops.forEach(backdrop => backdrop.remove());
            
            // Force restore body state
            document.body.classList.remove('modal-open');
            document.body.style.overflow = '';
            document.body.style.paddingRight = '';
            
            // Clear any video sources to stop playback
            const video = document.getElementById('guestFullscreenVideo');
            if (video && !video.classList.contains('d-none')) {
                video.pause();
                video.src = '';
            }
            // Clear image source
            const image = document.getElementById('guestFullscreenImage');
            if (image && !image.classList.contains('d-none')) {
                image.src = '';
            }
            // Reset current file
            window.guestCurrentFile = null;
            
            // CLEANUP: Stop size force interval
            if (window.guestCurrentSizeForceInterval) {
                clearInterval(window.guestCurrentSizeForceInterval);
                window.guestCurrentSizeForceInterval = null;

            }
            

        });
        
        // Handle modal show event
        modal.addEventListener('shown.bs.modal', function () {

            // Start auto-hide timer
            showControls();
        });
        
        // Add additional cleanup on hide start
        modal.addEventListener('hide.bs.modal', function () {

            // Clear focus immediately
            if (document.activeElement && document.activeElement.blur) {
                document.activeElement.blur();
            }
            // Clear auto-hide timer
            clearTimeout(hideTimeout);
            modal.classList.remove('auto-hide');
        });
    }
}
</script>

<script>
    // Geschenkliste Dashboard Funktionen
    let dashboardGeschenke = [];
    let dashboardMeineGeschenke = [];
    let geldgeschenkConfig = null;
    let meineGeldgeschenkAuswahl = null;

    async function loadDashboardGeschenkliste() {
        try {
            console.log('🎁 Lade Dashboard Geschenkliste...');
            
            // Loading anzeigen
            document.getElementById('dashboard-geschenke-loading').style.display = 'block';
            document.getElementById('dashboard-geschenke-container').style.display = 'none';
            document.getElementById('dashboard-keine-geschenke').style.display = 'none';

            // Verfügbare Geschenke laden
            console.log('📡 API Request: /api/geschenkliste/list');
            const response = await fetch('/api/geschenkliste/list');
            console.log('📡 Response Status:', response.status, response.statusText);
            
            const data = await response.json();
            console.log('📡 Response Data:', data);
            
            if (data.success) {
                dashboardGeschenke = data.geschenke.filter(g => g.ausgewaehlt_menge < g.menge);
                console.log('✅ Verfügbare Geschenke:', dashboardGeschenke.length);
                
                // Geldgeschenk-Konfiguration laden
                await loadGeldgeschenkConfig();
                
                // Meine Geschenke laden
                await loadDashboardMeineGeschenke();
                
                // Geschenke rendern
                renderDashboardGeschenke(dashboardGeschenke);
            } else {
                console.error('❌ Fehler beim Laden der Geschenke:', data.error);
                showDashboardToast('Fehler beim Laden der Geschenke: ' + (data.error || 'Unbekannter Fehler'), 'error');
            }
        } catch (error) {
            console.error('❌ Netzwerkfehler beim Laden der Geschenkliste:', error);
            showDashboardToast('Netzwerkfehler beim Laden der Geschenkliste', 'error');
        } finally {
            document.getElementById('dashboard-geschenke-loading').style.display = 'none';
        }
    }

    async function loadGeldgeschenkConfig() {
        try {
            console.log('💰 Lade Geldgeschenk-Konfiguration...');
            const response = await fetch('/api/geldgeschenk/guest-config');
            console.log('💰 Config Response Status:', response.status);
            
            const data = await response.json();
            console.log('💰 Config Data:', data);
            
            if (data.success && data.config) {
                geldgeschenkConfig = data.config;
                console.log('✅ Geldgeschenk-Config geladen:', geldgeschenkConfig);
            } else {
                console.log('ℹ️ Keine Geldgeschenk-Konfiguration verfügbar');
            }

            // Meine Geldgeschenk-Auswahl laden
            console.log('🔍 Lade meine Geldgeschenk-Auswahl...');
            const meineResponse = await fetch('/api/geldgeschenk/meine');
            console.log('🔍 Meine Response Status:', meineResponse.status);
            
            const meineData = await meineResponse.json();
            console.log('🔍 Meine Data:', meineData);
            
            if (meineData.success) {
                meineGeldgeschenkAuswahl = meineData.ausgewaehlt ? meineData.auswahl : null;
                console.log('✅ Meine Geldgeschenk-Auswahl:', meineGeldgeschenkAuswahl);
            }
        } catch (error) {
            console.error('❌ Fehler beim Laden der Geldgeschenk-Konfiguration:', error);
        }
    }

    async function loadDashboardMeineGeschenke() {
        try {
            const response = await fetch('/api/geschenkliste/meine');
            const data = await response.json();
            
            if (data.success) {
                dashboardMeineGeschenke = data.geschenke;
                renderDashboardMeineGeschenke();
            }
        } catch (error) {
            console.error('Fehler beim Laden eigener Geschenke:', error);
        }
    }

    function renderDashboardMeineGeschenke() {
        const section = document.getElementById('meine-geschenke-section');
        const inhalt = document.getElementById('meine-geschenke-inhalt');
        
        let hasGeschenke = dashboardMeineGeschenke.length > 0 || meineGeldgeschenkAuswahl;
        
        if (!hasGeschenke) {
            section.style.display = 'none';
            return;
        }

        section.style.display = 'block';
        let html = '';
        
        // Normale Geschenke
        dashboardMeineGeschenke.forEach(geschenk => {
            const preis = geschenk.preis ? ` - ${geschenk.preis} ${geschenk.waehrung}` : '';
            
            html += `
                <div class="border rounded p-3 mb-2 bg-light">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <strong>🎁 ${geschenk.name}</strong>${preis}
                            <br><small class="text-muted">${geschenk.beschreibung || ''}</small>
                            <br><small class="text-success">Ausgewählt am: ${new Date(geschenk.ausgewaehlt_am).toLocaleDateString('de-DE')}</small>
                        </div>
                        <button class="btn btn-outline-warning btn-sm" onclick="freigebenDashboardGeschenk(${geschenk.id})">
                            <i class="bi bi-arrow-counterclockwise"></i> Freigeben
                        </button>
                    </div>
                </div>
            `;
        });

        // Geldgeschenk
        if (meineGeldgeschenkAuswahl) {
            const betrag = meineGeldgeschenkAuswahl.betrag ? ` - ${meineGeldgeschenkAuswahl.betrag} ${meineGeldgeschenkAuswahl.waehrung || 'EUR'}` : '';
            const hasPaypalLink = geldgeschenkConfig && geldgeschenkConfig.paypal_link;
            
            html += `
                <div class="border rounded p-3 mb-2 bg-light">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <strong>💰 ${geldgeschenkConfig ? geldgeschenkConfig.name : 'Geldgeschenk'}</strong>${betrag}
                            <br><small class="text-muted">${meineGeldgeschenkAuswahl.notiz || 'Geldgeschenk'}</small>
                            <br><small class="text-success">Ausgewählt am: ${new Date(meineGeldgeschenkAuswahl.ausgewaehlt_am).toLocaleDateString('de-DE')}</small>
                        </div>
                        <div class="d-flex gap-2">
                            ${hasPaypalLink ? `
                                <button class="btn btn-outline-primary btn-sm" onclick="window.open(${JSON.stringify(geldgeschenkConfig.paypal_link)}, '_blank')" title="PayPal öffnen">
                                    <i class="bi bi-credit-card"></i> PayPal
                                </button>
                            ` : ''}
                            <button class="btn btn-outline-warning btn-sm" onclick="freigebenDashboardGeldgeschenk()">
                                <i class="bi bi-arrow-counterclockwise"></i> Freigeben
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }
        
        inhalt.innerHTML = html;
    }

    function renderDashboardGeschenke(geschenke) {
        const container = document.getElementById('dashboard-geschenke-container');
        const tbody = document.getElementById('dashboard-geschenke-tbody');
        const keineGeschenke = document.getElementById('dashboard-keine-geschenke');
        
        if (!tbody) {
            console.error('❌ Element dashboard-geschenke-tbody nicht gefunden');
            return;
        }
        
        // Prüfe ob Geldgeschenk verfügbar ist
        const geldgeschenkVerfuegbar = geldgeschenkConfig && geldgeschenkConfig.aktiv && !meineGeldgeschenkAuswahl;
        const totalGeschenke = geschenke.length + (geldgeschenkVerfuegbar ? 1 : 0);
        
        if (totalGeschenke === 0) {
            container.style.display = 'none';
            if (keineGeschenke) keineGeschenke.style.display = 'block';
            return;
        }

        container.style.display = 'block';
        if (keineGeschenke) keineGeschenke.style.display = 'none';
        tbody.innerHTML = '';

        // Geldgeschenk als erste Zeile hinzufügen
        if (geldgeschenkVerfuegbar) {
            const geldRow = document.createElement('tr');
            geldRow.style.backgroundColor = '#fff8e1';
            geldRow.innerHTML = `
                <td data-label="Geschenk">
                    <div class="d-flex align-items-center">
                        <span class="me-2" style="font-size: 1.5rem;">💰</span>
                        <div>
                            <strong style="color: var(--wedding-text);">${geldgeschenkConfig.name}</strong>
                            <br><small class="text-muted">${geldgeschenkConfig.beschreibung || 'Unterstützen Sie uns mit einem Geldgeschenk'}</small>
                        </div>
                    </div>
                </td>
                <td data-label="Kategorie"><span class="badge" style="background-color: var(--wedding-gold); color: var(--wedding-text);">Geldgeschenk</span></td>
                <td data-label="Preis"><strong style="color: var(--wedding-gold);">Wunschbetrag</strong></td>
                <td data-label="Verfügbar"><span class="badge bg-success">Immer verfügbar</span></td>
                <td data-label="Aktion">
                    <button class="btn btn-wedding-primary btn-sm w-100" onclick="selectDashboardGeldgeschenk()">
                        <i class="bi bi-heart me-1"></i> Auswählen
                    </button>
                </td>
            `;
            tbody.appendChild(geldRow);
        }

        // Normale Geschenke als Tabellenzeilen
        geschenke.forEach(geschenk => {
            try {
                const row = document.createElement('tr');
                const verfuegbar = geschenk.menge - geschenk.ausgewaehlt_menge;
                const kategorieBadgeColor = {
                    'Haushalt': 'bg-primary',
                    'Küche': 'bg-success', 
                    'Dekoration': 'bg-warning',
                    'Geld': 'bg-info',
                    'Sonstiges': 'bg-secondary'
                }[geschenk.kategorie] || 'bg-secondary';
                
                const beschreibung = geschenk.beschreibung || '';
                
                row.innerHTML = `
                    <td data-label="Geschenk">
                        <div>
                            <strong style="color: var(--wedding-text);">${geschenk.name}</strong>
                            ${beschreibung ? `<br><small class="text-muted">${beschreibung.substring(0, 50)}${beschreibung.length > 50 ? '...' : ''}</small>` : ''}
                        </div>
                    </td>
                    <td data-label="Kategorie">
                        <span class="badge ${kategorieBadgeColor}">${geschenk.kategorie || 'Sonstiges'}</span>
                    </td>
                    <td data-label="Preis">
                        <strong style="color: var(--wedding-gold);">
                            ${geschenk.kategorie === 'Geld' || geschenk.ist_geldgeschenk ? 'Wunschbetrag' : (geschenk.preis ? geschenk.preis.toFixed(2) + ' €' : 'Nicht angegeben')}
                        </strong>
                    </td>
                    <td data-label="Verfügbar">
                        <span class="badge ${verfuegbar > 0 ? 'bg-success' : 'bg-danger'}">${verfuegbar} von ${geschenk.menge}</span>
                    </td>
                    <td data-label="Aktion">
                        <button class="btn btn-wedding-primary btn-sm w-100" onclick="selectDashboardGeschenk(${geschenk.id})" ${verfuegbar <= 0 ? 'disabled' : ''}>
                            <i class="bi bi-heart me-1"></i> ${verfuegbar > 0 ? 'Auswählen' : 'Nicht verfügbar'}
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            } catch (error) {
                console.error('❌ Fehler beim Rendern von Geschenk:', geschenk, error);
            }
        });
    }

    async function selectDashboardGeldgeschenk() {
        if (!geldgeschenkConfig) return;

        // Modal-Daten setzen
        document.getElementById('geldgeschenkName').textContent = geldgeschenkConfig.name;
        document.getElementById('geldgeschenkBeschreibung').textContent = geldgeschenkConfig.beschreibung || 'Unterstützen Sie uns mit einem Geldgeschenk für unsere gemeinsame Zukunft.';
        
        // Formular zurücksetzen
        document.getElementById('geldgeschenkBetrag').value = '';
        document.getElementById('geldgeschenkNotiz').value = '';
        
        // Modal anzeigen
        const modal = new bootstrap.Modal(document.getElementById('geldgeschenkModal'));
        modal.show();
    }

    // Event Listener für Geldgeschenk-Bestätigung
    document.addEventListener('DOMContentLoaded', function() {
        const confirmButton = document.getElementById('confirmGeldgeschenk');
        if (confirmButton) {
            confirmButton.addEventListener('click', async function() {
                const betrag = document.getElementById('geldgeschenkBetrag').value;
                const notiz = document.getElementById('geldgeschenkNotiz').value;

                try {
                    const response = await fetch('/api/geldgeschenk/waehlen', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ 
                            betrag: betrag ? parseFloat(betrag) : null,
                            notiz: notiz || null
                        })
                    });

                    const data = await response.json();
                    
                    if (data.success) {
                        // Modal schließen
                        const modal = bootstrap.Modal.getInstance(document.getElementById('geldgeschenkModal'));
                        modal.hide();
                        
                        // Toast anzeigen
                        showDashboardToast('Geldgeschenk erfolgreich ausgewählt! Vielen Dank!', 'success');
                        
                        // PayPal-Link öffnen
                        if (geldgeschenkConfig.paypal_link) {
                            setTimeout(() => {
                                window.open(geldgeschenkConfig.paypal_link, '_blank');
                            }, 500); // Kurze Verzögerung, damit der Toast sichtbar wird
                        }
                        
                        // Geschenkliste neu laden
                        loadDashboardGeschenkliste();
                    } else {
                        showDashboardToast(data.error || 'Fehler beim Auswählen des Geldgeschenks', 'error');
                    }
                } catch (error) {
                    console.error('Fehler beim Auswählen des Geldgeschenks:', error);
                    showDashboardToast('Netzwerkfehler beim Auswählen', 'error');
                }
            });
        }
    });

    async function freigebenDashboardGeldgeschenk() {
        // Modal anzeigen
        const modal = new bootstrap.Modal(document.getElementById('geldgeschenkFreigebenModal'));
        modal.show();
        
        // Event Listener für Bestätigung (einmalig setzen)
        const confirmButton = document.getElementById('confirmGeldgeschenkFreigeben');
        const newConfirmButton = confirmButton.cloneNode(true);
        confirmButton.parentNode.replaceChild(newConfirmButton, confirmButton);
        
        newConfirmButton.addEventListener('click', async function() {
            try {
                const response = await fetch('/api/geldgeschenk/freigeben', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({})
                });

                const data = await response.json();
                
                if (data.success) {
                    // Modal schließen
                    const modalInstance = bootstrap.Modal.getInstance(document.getElementById('geldgeschenkFreigebenModal'));
                    modalInstance.hide();
                    
                    showDashboardToast('Geldgeschenk erfolgreich freigegeben', 'success');
                    loadDashboardGeschenkliste();
                } else {
                    showDashboardToast(data.error || 'Fehler beim Freigeben', 'error');
                }
            } catch (error) {
                console.error('Fehler beim Freigeben des Geldgeschenks:', error);
                showDashboardToast('Netzwerkfehler beim Freigeben', 'error');
            }
        });
    }

    async function selectDashboardGeschenk(geschenkId) {
        const geschenk = dashboardGeschenke.find(g => g.id === geschenkId);
        if (!geschenk) return;

        // Normales Geschenk - Bestätigung
        const verfuegbar = geschenk.menge - (geschenk.ausgewaehlt_menge || 0);
        let menge = 1;
        
        if (verfuegbar > 1) {
            const mengeInput = prompt(`Wie viele "${geschenk.name}" möchten Sie auswählen?\n\nVerfügbar: ${verfuegbar} Stück`, '1');
            if (!mengeInput || mengeInput === '' || isNaN(mengeInput)) return;
            menge = parseInt(mengeInput);
            if (menge < 1 || menge > verfuegbar) {
                alert('Ungültige Menge!');
                return;
            }
        }

        const bestätigung = confirm(`"${geschenk.name}" ${menge > 1 ? `(${menge}x)` : ''} auswählen?\n\nDas Geschenk wird dann für andere Gäste nicht mehr sichtbar sein.`);
        if (bestätigung) {
            confirmDashboardSelection(geschenkId, menge);
        }
    }

    async function confirmDashboardSelection(geschenkId, menge) {
        try {
            const response = await fetch(`/api/geschenkliste/waehlen/${geschenkId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ menge: menge })
            });

            const data = await response.json();
            
            if (data.success) {
                showDashboardToast('Geschenk erfolgreich ausgewählt! Vielen Dank!', 'success');
                // Geschenkliste neu laden
                loadDashboardGeschenkliste();
            } else {
                showDashboardToast(data.error || 'Fehler beim Auswählen des Geschenks', 'error');
            }
        } catch (error) {
            console.error('Fehler beim Auswählen:', error);
            showDashboardToast('Netzwerkfehler beim Auswählen', 'error');
        }
    }

    async function freigebenDashboardGeschenk(geschenkId) {
        const geschenk = dashboardMeineGeschenke.find(g => g.id === geschenkId);
        if (!geschenk) return;

        // Modal-Daten setzen
        document.getElementById('freigebenGeschenkName').textContent = `"${geschenk.name}" freigeben?`;
        
        // Modal anzeigen
        const modal = new bootstrap.Modal(document.getElementById('freigebenModal'));
        modal.show();
        
        // Event Listener für Bestätigung (einmalig setzen)
        const confirmButton = document.getElementById('confirmFreigeben');
        const newConfirmButton = confirmButton.cloneNode(true);
        confirmButton.parentNode.replaceChild(newConfirmButton, confirmButton);
        
        newConfirmButton.addEventListener('click', async function() {
            try {
                const response = await fetch(`/api/geschenkliste/freigeben/${geschenkId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({})
                });

                const data = await response.json();
                
                if (data.success) {
                    // Modal schließen
                    const modalInstance = bootstrap.Modal.getInstance(document.getElementById('freigebenModal'));
                    modalInstance.hide();
                    
                    showDashboardToast('Geschenk erfolgreich freigegeben', 'success');
                    loadDashboardGeschenkliste();
                } else {
                    showDashboardToast(data.error || 'Fehler beim Freigeben', 'error');
                }
            } catch (error) {
                console.error('Fehler beim Freigeben:', error);
                showDashboardToast('Netzwerkfehler beim Freigeben', 'error');
            }
        });
    }

    function showGeschenkDetails(geschenkId) {
        const geschenk = dashboardGeschenke.find(g => g.id === geschenkId);
        if (!geschenk) return;

        // Modal-Daten setzen
        document.getElementById('geschenkDetailName').textContent = geschenk.name;
        document.getElementById('geschenkDetailKategorie').textContent = geschenk.kategorie;
        document.getElementById('geschenkDetailBeschreibung').textContent = geschenk.beschreibung || 'Keine Beschreibung verfügbar';
        
        // Preis
        const preis = geschenk.preis ? `${geschenk.preis} ${geschenk.waehrung}` : 'Preis auf Anfrage';
        document.getElementById('geschenkDetailPreis').textContent = preis;
        
        // Verfügbarkeit
        const verfuegbar = geschenk.menge - (geschenk.ausgewaehlt_menge || 0);
        document.getElementById('geschenkDetailVerfuegbar').textContent = `${verfuegbar} Stück`;
        
        // Priorität Badge
        const prioritaetBadge = document.getElementById('geschenkDetailPrioritaet');
        if (geschenk.prioritaet === 'Hoch') {
            prioritaetBadge.className = 'badge bg-danger';
            prioritaetBadge.textContent = 'Hohe Priorität';
            prioritaetBadge.style.display = 'inline';
        } else if (geschenk.prioritaet === 'Niedrig') {
            prioritaetBadge.className = 'badge bg-secondary';
            prioritaetBadge.textContent = 'Niedrige Priorität';
            prioritaetBadge.style.display = 'inline';
        } else {
            prioritaetBadge.style.display = 'none';
        }
        
        // Bild
        const bildContainer = document.getElementById('geschenkDetailBild');
        if (geschenk.bild_url) {
            bildContainer.innerHTML = `
                <img src="${geschenk.bild_url}" class="img-fluid rounded shadow" 
                     alt="${geschenk.name}" style="max-height: 300px; width: 100%; object-fit: cover;">
            `;
            bildContainer.parentElement.className = 'row';
            document.getElementById('geschenkDetailInfo').className = 'col-md-6';
        } else {
            bildContainer.innerHTML = '';
            bildContainer.parentElement.className = '';
            document.getElementById('geschenkDetailInfo').className = 'col-12';
        }
        
        // Produkt-Link Button
        const produktLinkBtn = document.getElementById('geschenkDetailProduktLink');
        if (geschenk.link) {
            produktLinkBtn.style.display = 'inline-block';
            produktLinkBtn.onclick = () => window.open(geschenk.link, '_blank');
        } else {
            produktLinkBtn.style.display = 'none';
        }
        
        // Auswählen Button
        const auswählenBtn = document.getElementById('geschenkDetailAuswählen');
        auswählenBtn.onclick = () => {
            const modal = bootstrap.Modal.getInstance(document.getElementById('geschenkDetailModal'));
            modal.hide();
            selectDashboardGeschenk(geschenkId);
        };
        
        // Modal anzeigen
        const modal = new bootstrap.Modal(document.getElementById('geschenkDetailModal'));
        modal.show();
    }

    function applyDashboardGeschenkFilter() {
        const kategorie = document.getElementById('dashboard-kategorie-filter').value;
        const preisRange = document.getElementById('dashboard-preis-filter').value;
        const search = document.getElementById('dashboard-search-input').value.toLowerCase();

        let filteredGeschenke = dashboardGeschenke.filter(geschenk => {
            // Kategorie Filter
            if (kategorie && geschenk.kategorie !== kategorie) return false;
            
            // Preis Filter
            if (preisRange && geschenk.preis) {
                const preis = geschenk.preis;
                if (preisRange === '0-25' && preis > 25) return false;
                if (preisRange === '25-50' && (preis <= 25 || preis > 50)) return false;
                if (preisRange === '50-100' && (preis <= 50 || preis > 100)) return false;
                if (preisRange === '100-200' && (preis <= 100 || preis > 200)) return false;
                if (preisRange === '200+' && preis <= 200) return false;
            }
            
            // Such Filter
            if (search && !geschenk.name.toLowerCase().includes(search) && 
                !geschenk.beschreibung?.toLowerCase().includes(search)) return false;
            
            return true;
        });

        renderDashboardGeschenke(filteredGeschenke);
    }

    function showDashboardToast(message, type) {
        const toast = document.createElement('div');
        const bgClass = type === 'success' ? 'bg-success' : 'bg-danger';
        toast.className = `toast align-items-center text-white ${bgClass} border-0 position-fixed`;
        toast.style.cssText = 'top: 20px; right: 20px; z-index: 9999;';
        toast.innerHTML = `
            <div class="d-flex">
                <div class="toast-body">${message}</div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
            </div>
        `;
        document.body.appendChild(toast);
        new bootstrap.Toast(toast).show();
        setTimeout(() => toast.remove(), 5000);
    }

    // Geschenkliste Text-Konfiguration laden
    async function loadGeschenklisteTextConfig() {
        try {
            const response = await fetch('/api/geschenkliste/guest-text-config');
            const data = await response.json();
            
            if (data.success && data.config) {
                const titelElement = document.getElementById('geschenkliste-titel');
                const beschreibungElement = document.getElementById('geschenkliste-beschreibung');
                
                if (titelElement) {
                    titelElement.innerHTML = `<i class="bi bi-gift me-2"></i>${data.config.titel}`;
                }
                
                if (beschreibungElement) {
                    beschreibungElement.textContent = data.config.beschreibung;
                }
            }
        } catch (error) {
            console.error('Fehler beim Laden der Geschenkliste Text-Konfiguration:', error);
        }
    }

    // Event Listeners für Dashboard Geschenkliste
    document.addEventListener('DOMContentLoaded', function() {
        // Geschenkliste Text-Konfiguration laden
        loadGeschenklisteTextConfig();
        
        // Toggle-Button für Geschenkliste-Info
        const toggleBtn = document.getElementById('toggle-geschenkliste-info');
        const toggleIcon = document.getElementById('toggle-icon');
        const geschenklisteInfo = document.getElementById('geschenkliste-info');
        
        if (toggleBtn && toggleIcon && geschenklisteInfo) {
            geschenklisteInfo.addEventListener('shown.bs.collapse', function() {
                toggleIcon.className = 'bi bi-chevron-up';
            });
            
            geschenklisteInfo.addEventListener('hidden.bs.collapse', function() {
                toggleIcon.className = 'bi bi-chevron-down';
            });
        }
        
        // Filter Event Listeners
        document.getElementById('dashboard-kategorie-filter')?.addEventListener('change', applyDashboardGeschenkFilter);
        document.getElementById('dashboard-preis-filter')?.addEventListener('change', applyDashboardGeschenkFilter);
        document.getElementById('dashboard-search-input')?.addEventListener('input', applyDashboardGeschenkFilter);

        // Tab Event Listener
        const geschenkeTab = document.getElementById('geschenke-tab');
        if (geschenkeTab) {
            console.log('✅ Geschenke-Tab Event Listener hinzugefügt');
            geschenkeTab.addEventListener('click', function() {
                console.log('🖱️ Geschenke-Tab geklickt');
                // Kleine Verzögerung für Tab-Transition
                setTimeout(() => {
                    loadDashboardGeschenkliste();
                }, 100);
            });
        } else {
            console.error('❌ Geschenke-Tab nicht gefunden!');
        }

        // Initial load falls bereits im Tab
        const currentPane = document.querySelector('.tab-pane.active');
        if (currentPane && currentPane.id === 'geschenke-pane') {
            console.log('🚀 Initial Load: Bereits im Geschenke-Tab');
            loadDashboardGeschenkliste();
        }
    });
</script>

<!-- Galerie Modal -->
<div class="modal fade" id="galleryModal" tabindex="-1" role="dialog" aria-labelledby="galleryModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered" role="document">
        <div class="modal-content" style="background: #000;">
            <div class="modal-header border-0" style="background: rgba(0,0,0,0.8);">
                <h5 class="modal-title text-white" id="galleryModalTitle">Foto</h5>
                <div class="d-flex align-items-center">
                    <span class="text-white me-3" id="galleryCounter">1 / 1</span>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Schließen"></button>
                </div>
            </div>
            <div class="modal-body p-0 d-flex align-items-center justify-content-center" style="min-height: 60vh; background: #000;" id="galleryModalBody">
                <!-- Wird dynamisch gefüllt -->
            </div>
            <div class="modal-footer border-0 justify-content-center" style="background: rgba(0,0,0,0.8);">
                <button type="button" class="btn btn-outline-light" id="galleryPrevBtn" onclick="navigateGallery('prev')">
                    <i class="bi bi-chevron-left"></i> Zurück
                </button>
                <button type="button" class="btn btn-outline-light ms-2" id="galleryNextBtn" onclick="navigateGallery('next')">
                    Weiter <i class="bi bi-chevron-right"></i>
                </button>
            </div>
        </div>
    </div>
</div>

{% endblock %}


