{% extends "base.html" %}

{% block title %}Notizliste - Hochzeitsplaner{% endblock %}

{% block extra_head %}
<style>
    .priority-dringend { border-left: 4px solid #dc3545; }
    .priority-hoch { border-left: 4px solid #fd7e14; }
    .priority-normal { border-left: 4px solid #0d6efd; }
    .priority-niedrig { border-left: 4px solid #6c757d; }
    
    .priority-badge-dringend { background-color: #dc3545; }
    .priority-badge-hoch { background-color: #fd7e14; }
    .priority-badge-normal { background-color: #0d6efd; }
    .priority-badge-niedrig { background-color: #6c757d; }
    
    .notiz-card {
        transition: transform 0.2s;
        cursor: pointer;
    }
    
    .notiz-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    
    .notiz-inhalt {
        max-height: 100px;
        overflow: hidden;
        position: relative;
    }
    
    .notiz-inhalt.expanded {
        max-height: none;
    }
    
    .fade-overlay {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 30px;
        background: linear-gradient(transparent, white);
        pointer-events: none;
    }
    
    .kategorie-filter .btn {
        margin: 2px;
        font-size: 0.875rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-md-8">
            <h2 class="h3 mb-2">
                <i class="bi bi-sticky me-2" style="color: #d4af37;"></i>
                Notizliste
            </h2>
            <p class="text-muted mb-0">
                Wichtige Notizen und Ideen fÃ¼r Ihre Hochzeit verwalten
            </p>
        </div>
        <div class="col-md-4 text-end">
            <button type="button" class="btn btn-wedding-primary" data-bs-toggle="modal" data-bs-target="#notizModal">
                <i class="bi bi-plus-circle me-1"></i> Neue Notiz
            </button>
        </div>
    </div>

    <!-- Filter und Statistiken -->
    <div class="row mb-4">
        <div class="col-md-8">
            <div class="kategorie-filter">
                <button class="btn btn-outline-secondary active" data-kategorie="alle">
                    <i class="bi bi-list-ul me-1"></i> Alle
                </button>
                <button class="btn btn-outline-primary" data-kategorie="Allgemein">
                    <i class="bi bi-journal-text me-1"></i> Allgemein
                </button>
                <button class="btn btn-outline-success" data-kategorie="Dekoration">
                    <i class="bi bi-flower1 me-1"></i> Dekoration
                </button>
                <button class="btn btn-outline-warning" data-kategorie="Catering">
                    <i class="bi bi-cup-hot me-1"></i> Catering
                </button>
                <button class="btn btn-outline-info" data-kategorie="Musik">
                    <i class="bi bi-music-note me-1"></i> Musik
                </button>
                <button class="btn btn-outline-danger" data-kategorie="Dringend">
                    <i class="bi bi-exclamation-triangle me-1"></i> Dringend
                </button>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card bg-light">
                <div class="card-body py-2">
                    <div class="row text-center">
                        <div class="col-6">
                            <div class="h5 mb-0" id="total-notizen">0</div>
                            <small class="text-muted">Notizen</small>
                        </div>
                        <div class="col-6">
                            <div class="h5 mb-0" id="dringend-notizen">0</div>
                            <small class="text-muted">Dringend</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Suchfeld -->
    <div class="row mb-3">
        <div class="col-md-6">
            <div class="input-group">
                <span class="input-group-text">
                    <i class="bi bi-search"></i>
                </span>
                <input type="text" class="form-control" id="searchInput" placeholder="Notizen durchsuchen...">
            </div>
        </div>
        <div class="col-md-6">
            <select class="form-select" id="sortSelect">
                <option value="prioritaet">Nach PrioritÃ¤t sortieren</option>
                <option value="datum">Nach Datum sortieren</option>
                <option value="titel">Nach Titel sortieren</option>
                <option value="kategorie">Nach Kategorie sortieren</option>
            </select>
        </div>
    </div>

    <!-- Loading State -->
    <div id="loading-state" class="text-center my-5">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Notizen werden geladen...</span>
        </div>
        <p class="mt-3 text-muted">Notizen werden geladen...</p>
    </div>

    <!-- Notizen Grid -->
    <div id="notizen-container" class="row g-3" style="display: none;">
        <!-- Notizen werden hier dynamisch geladen -->
    </div>

    <!-- Empty State -->
    <div id="empty-state" class="text-center my-5" style="display: none;">
        <i class="bi bi-sticky display-1 text-muted mb-3"></i>
        <h4 class="text-muted">Keine Notizen gefunden</h4>
        <p class="text-muted">Erstellen Sie Ihre erste Notiz, um wichtige Ideen festzuhalten.</p>
        <button type="button" class="btn btn-wedding-primary" data-bs-toggle="modal" data-bs-target="#notizModal">
            <i class="bi bi-plus-circle me-1"></i> Erste Notiz erstellen
        </button>
    </div>
</div>

<!-- Notiz Modal -->
<div class="modal fade" id="notizModal" tabindex="-1" aria-labelledby="notizModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="notizModalLabel">
                    <i class="bi bi-sticky me-2"></i>
                    <span id="modal-title-text">Neue Notiz</span>
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="notizForm" onsubmit="return false;">
                <div class="modal-body">
                    <input type="hidden" id="notiz-id" name="notiz_id">
                    
                    <div class="row">
                        <div class="col-md-8">
                            <div class="mb-3">
                                <label for="notiz-titel" class="form-label">Titel *</label>
                                <input type="text" class="form-control" id="notiz-titel" name="titel" required 
                                       placeholder="Titel der Notiz">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="notiz-prioritaet" class="form-label">PrioritÃ¤t</label>
                                <select class="form-select" id="notiz-prioritaet" name="prioritaet">
                                    <option value="Niedrig">ðŸ”µ Niedrig</option>
                                    <option value="Normal" selected>ðŸŸ¡ Normal</option>
                                    <option value="Hoch">ðŸŸ  Hoch</option>
                                    <option value="Dringend">ðŸ”´ Dringend</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="notiz-kategorie" class="form-label">Kategorie</label>
                        <input type="text" class="form-control" id="notiz-kategorie" name="kategorie" 
                               list="kategorien-list" placeholder="z.B. Dekoration, Catering, Musik">
                        <datalist id="kategorien-list">
                            <option value="Allgemein">
                            <option value="Dekoration">
                            <option value="Catering">
                            <option value="Musik">
                            <option value="Fotografie">
                            <option value="GÃ¤ste">
                            <option value="Location">
                            <option value="Kleidung">
                            <option value="Blumen">
                            <option value="Transport">
                        </datalist>
                    </div>
                    
                    <div class="mb-3">
                        <label for="notiz-inhalt" class="form-label">Inhalt</label>
                        <textarea class="form-control" id="notiz-inhalt" name="inhalt" rows="6" 
                                  placeholder="Notiz-Inhalt..."></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="bi bi-x-circle me-1"></i> Abbrechen
                    </button>
                    <button type="button" class="btn btn-wedding-primary" id="submit-button">
                        <i class="bi bi-check-circle me-1"></i> 
                        <span id="submit-text">Notiz erstellen</span>
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Notiz Details Modal -->
<div class="modal fade" id="notizDetailsModal" tabindex="-1" aria-labelledby="notizDetailsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="notizDetailsModalLabel">
                    <i class="bi bi-sticky me-2"></i>
                    <span id="details-titel">Notiz Details</span>
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row mb-3">
                    <div class="col-md-6">
                        <strong>Kategorie:</strong> <span id="details-kategorie"></span>
                    </div>
                    <div class="col-md-6">
                        <strong>PrioritÃ¤t:</strong> 
                        <span class="badge" id="details-prioritaet-badge"></span>
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-md-6">
                        <strong>Erstellt von:</strong> <span id="details-erstellt-von"></span>
                    </div>
                    <div class="col-md-6">
                        <strong>Erstellt am:</strong> <span id="details-erstellt-am"></span>
                    </div>
                </div>
                <div class="mb-3">
                    <strong>Inhalt:</strong>
                    <div class="mt-2 p-3 bg-light rounded" id="details-inhalt" style="white-space: pre-wrap;">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-primary" onclick="editNotiz()">
                    <i class="bi bi-pencil me-1"></i> Bearbeiten
                </button>
                <button type="button" class="btn btn-outline-danger" onclick="deleteNotiz()">
                    <i class="bi bi-trash me-1"></i> LÃ¶schen
                </button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="bi bi-x-circle me-1"></i> SchlieÃŸen
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/notizen.js') }}?v={{ range(1, 1000) | random }}"></script>
{% endblock %}
